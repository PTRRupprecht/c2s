<?xml version="1.0" encoding="ascii"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
          "DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <title>c2s.c2s</title>
  <link rel="stylesheet" href="epydoc.css" type="text/css" />
  <script type="text/javascript" src="epydoc.js"></script>
</head>

<body bgcolor="white" text="black" link="blue" vlink="#204080"
      alink="#204080">
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th bgcolor="#70b0f0" class="navbar-select"
          >&nbsp;&nbsp;&nbsp;Home&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="https://github.com/lucastheis/c2s">c2s</a></th>
          </tr></table></th>
  </tr>
</table>
<table width="100%" cellpadding="0" cellspacing="0">
  <tr valign="top">
    <td width="100%">
      <span class="breadcrumbs">
        Package&nbsp;c2s ::
        Module&nbsp;c2s
      </span>
    </td>
    <td>
      <table cellpadding="0" cellspacing="0">
        <!-- hide/show private -->
        <tr><td align="right"><span class="options">[<a href="javascript:void(0);" class="privatelink"
    onclick="toggle_private();">hide&nbsp;private</a>]</span></td></tr>
        <tr><td align="right"><span class="options"
            >[<a href="frames.html" target="_top">frames</a
            >]&nbsp;|&nbsp;<a href="c2s.c2s-pysrc.html"
            target="_top">no&nbsp;frames</a>]</span></td></tr>
      </table>
    </td>
  </tr>
</table>
<h1 class="epydoc">Source Code for <a href="c2s.c2s-module.html" onclick="show_private();">Module c2s.c2s</a></h1>
<pre class="py-src">
<a name="L1"></a><tt class="py-lineno">  1</tt>  <tt class="py-line"><tt class="py-docstring">"""</tt> </tt>
<a name="L2"></a><tt class="py-lineno">  2</tt>  <tt class="py-line"><tt class="py-docstring">Tools for the prediction of spike trains from calcium traces.</tt> </tt>
<a name="L3"></a><tt class="py-lineno">  3</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L4"></a><tt class="py-lineno">  4</tt>  <tt class="py-line"><tt class="py-docstring">This module contains functions for predicting spikes from fluorescence traces obtained</tt> </tt>
<a name="L5"></a><tt class="py-lineno">  5</tt>  <tt class="py-line"><tt class="py-docstring">from two-photon calcium images. Data should be stored as a list of dictionaries, where</tt> </tt>
<a name="L6"></a><tt class="py-lineno">  6</tt>  <tt class="py-line"><tt class="py-docstring">each dictionary corresponds to a cell or recording. Each dictionary has to contain at least</tt> </tt>
<a name="L7"></a><tt class="py-lineno">  7</tt>  <tt class="py-line"><tt class="py-docstring">the entries C{calcium} and C{fps}, which correspond to the recorded fluorescence trace and</tt> </tt>
<a name="L8"></a><tt class="py-lineno">  8</tt>  <tt class="py-line"><tt class="py-docstring">its sampling rate in frames per second.</tt> </tt>
<a name="L9"></a><tt class="py-lineno">  9</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L10"></a><tt class="py-lineno"> 10</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt; data = [</tt> </tt>
<a name="L11"></a><tt class="py-lineno"> 11</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt;     {'calcium': [[0., 0., 0., 0.]],     'fps': 10.4},</tt> </tt>
<a name="L12"></a><tt class="py-lineno"> 12</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt;     {'calcium': [[0., 0., 0., 0., 0.]], 'fps': 12.1}]</tt> </tt>
<a name="L13"></a><tt class="py-lineno"> 13</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L14"></a><tt class="py-lineno"> 14</tt>  <tt class="py-line"><tt class="py-docstring">The data here is only used to illustrate the format. Each calcium trace is expected to</tt> </tt>
<a name="L15"></a><tt class="py-lineno"> 15</tt>  <tt class="py-line"><tt class="py-docstring">be given as a 1xT array, where T is the number of recorded frames. After importing the</tt> </tt>
<a name="L16"></a><tt class="py-lineno"> 16</tt>  <tt class="py-line"><tt class="py-docstring">module,</tt> </tt>
<a name="L17"></a><tt class="py-lineno"> 17</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L18"></a><tt class="py-lineno"> 18</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt; import c2s</tt> </tt>
<a name="L19"></a><tt class="py-lineno"> 19</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L20"></a><tt class="py-lineno"> 20</tt>  <tt class="py-line"><tt class="py-docstring">we can use L{preprocess&lt;c2s.preprocess&gt;} to normalize the calcium traces and</tt> </tt>
<a name="L21"></a><tt class="py-lineno"> 21</tt>  <tt class="py-line"><tt class="py-docstring">C{predict&lt;c2s.predict&gt;} to predict firing rates:</tt> </tt>
<a name="L22"></a><tt class="py-lineno"> 22</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L23"></a><tt class="py-lineno"> 23</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt; data = c2s.preprocess(data)</tt> </tt>
<a name="L24"></a><tt class="py-lineno"> 24</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt; data = c2s.predict(data)</tt> </tt>
<a name="L25"></a><tt class="py-lineno"> 25</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L26"></a><tt class="py-lineno"> 26</tt>  <tt class="py-line"><tt class="py-docstring">The predictions for the i-th cell can be accessed via:</tt> </tt>
<a name="L27"></a><tt class="py-lineno"> 27</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L28"></a><tt class="py-lineno"> 28</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt; data[i]['predictions']</tt> </tt>
<a name="L29"></a><tt class="py-lineno"> 29</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L30"></a><tt class="py-lineno"> 30</tt>  <tt class="py-line"><tt class="py-docstring">Simultaneously recorded spikes can be stored either as binned traces</tt> </tt>
<a name="L31"></a><tt class="py-lineno"> 31</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L32"></a><tt class="py-lineno"> 32</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt; data = [</tt> </tt>
<a name="L33"></a><tt class="py-lineno"> 33</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt;     {'calcium': [[0., 0., 0., 0.]],     'spikes': [[0, 1, 0, 2]],    'fps': 10.4},</tt> </tt>
<a name="L34"></a><tt class="py-lineno"> 34</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt;     {'calcium': [[0., 0., 0., 0., 0.]], 'spikes': [[0, 0, 3, 1, 0]], 'fps': 12.1}]</tt> </tt>
<a name="L35"></a><tt class="py-lineno"> 35</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L36"></a><tt class="py-lineno"> 36</tt>  <tt class="py-line"><tt class="py-docstring">or, preferably, as spike times in milliseconds:</tt> </tt>
<a name="L37"></a><tt class="py-lineno"> 37</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L38"></a><tt class="py-lineno"> 38</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt; data = [</tt> </tt>
<a name="L39"></a><tt class="py-lineno"> 39</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt;     {'calcium': [[0., 0., 0., 0.]],     'spike_times': [[15.1, 35.2, 38.1]],      'fps': 10.4},</tt> </tt>
<a name="L40"></a><tt class="py-lineno"> 40</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt;     {'calcium': [[0., 0., 0., 0., 0.]], 'spike_times': [[24.2, 28.4 32.7, 40.2]], 'fps': 12.1}]</tt> </tt>
<a name="L41"></a><tt class="py-lineno"> 41</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L42"></a><tt class="py-lineno"> 42</tt>  <tt class="py-line"><tt class="py-docstring">The preprocessing function will automatically compute the other format of the spike trains if one</tt> </tt>
<a name="L43"></a><tt class="py-lineno"> 43</tt>  <tt class="py-line"><tt class="py-docstring">of them is given. Using the method L{train&lt;c2s.train&gt;}, we can train a model to predict spikes from</tt> </tt>
<a name="L44"></a><tt class="py-lineno"> 44</tt>  <tt class="py-line"><tt class="py-docstring">fluorescence traces</tt> </tt>
<a name="L45"></a><tt class="py-lineno"> 45</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L46"></a><tt class="py-lineno"> 46</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt; data = c2s.preprocess(data)</tt> </tt>
<a name="L47"></a><tt class="py-lineno"> 47</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt; results = c2s.train(data)</tt> </tt>
<a name="L48"></a><tt class="py-lineno"> 48</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L49"></a><tt class="py-lineno"> 49</tt>  <tt class="py-line"><tt class="py-docstring">and then use it to make predictions:</tt> </tt>
<a name="L50"></a><tt class="py-lineno"> 50</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L51"></a><tt class="py-lineno"> 51</tt>  <tt class="py-line"><tt class="py-docstring">        &gt;&gt;&gt; data = c2s.predict(data, results)</tt> </tt>
<a name="L52"></a><tt class="py-lineno"> 52</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L53"></a><tt class="py-lineno"> 53</tt>  <tt class="py-line"><tt class="py-docstring">It is important that the data used for training undergoes the same preprocessing as the data</tt> </tt>
<a name="L54"></a><tt class="py-lineno"> 54</tt>  <tt class="py-line"><tt class="py-docstring">used when making predictions.</tt> </tt>
<a name="L55"></a><tt class="py-lineno"> 55</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L56"></a><tt class="py-lineno"> 56</tt>  <tt class="py-line"><tt class="py-docstring">@undocumented: optimize_predictions</tt> </tt>
<a name="L57"></a><tt class="py-lineno"> 57</tt>  <tt class="py-line"><tt class="py-docstring">@undocumented: robust_linear_regression</tt> </tt>
<a name="L58"></a><tt class="py-lineno"> 58</tt>  <tt class="py-line"><tt class="py-docstring">@undocumented: percentile_filter</tt> </tt>
<a name="L59"></a><tt class="py-lineno"> 59</tt>  <tt class="py-line"><tt class="py-docstring">@undocumented: downsample</tt> </tt>
<a name="L60"></a><tt class="py-lineno"> 60</tt>  <tt class="py-line"><tt class="py-docstring">@undocumented: responses</tt> </tt>
<a name="L61"></a><tt class="py-lineno"> 61</tt>  <tt class="py-line"><tt class="py-docstring">@undocumented: generate_inputs_and_outputs</tt> </tt>
<a name="L62"></a><tt class="py-lineno"> 62</tt>  <tt class="py-line"><tt class="py-docstring">@undocumented: DEFAULT_MODEL</tt> </tt>
<a name="L63"></a><tt class="py-lineno"> 63</tt>  <tt class="py-line"><tt class="py-docstring">"""</tt> </tt>
<a name="L64"></a><tt class="py-lineno"> 64</tt>  <tt class="py-line"> </tt>
<a name="L65"></a><tt class="py-lineno"> 65</tt>  <tt class="py-line"><tt class="py-name">__license__</tt> <tt class="py-op">=</tt> <tt class="py-string">'MIT License &lt;http://www.opensource.org/licenses/mit-license.php&gt;'</tt> </tt>
<a name="L66"></a><tt class="py-lineno"> 66</tt>  <tt class="py-line"><tt class="py-name">__author__</tt> <tt class="py-op">=</tt> <tt class="py-string">'Lucas Theis &lt;lucas@theis.io&gt;'</tt> </tt>
<a name="L67"></a><tt class="py-lineno"> 67</tt>  <tt class="py-line"><tt class="py-name">__docformat__</tt> <tt class="py-op">=</tt> <tt class="py-string">'epytext'</tt> </tt>
<a name="L68"></a><tt class="py-lineno"> 68</tt>  <tt class="py-line"><tt class="py-name">__version__</tt> <tt class="py-op">=</tt> <tt class="py-string">'0.1.0dev'</tt> </tt>
<a name="L69"></a><tt class="py-lineno"> 69</tt>  <tt class="py-line"> </tt>
<a name="L70"></a><tt class="py-lineno"> 70</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">copy</tt> <tt class="py-keyword">import</tt> <tt class="py-name">copy</tt><tt class="py-op">,</tt> <tt class="py-name">deepcopy</tt> </tt>
<a name="L71"></a><tt class="py-lineno"> 71</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">base64</tt> <tt class="py-keyword">import</tt> <tt class="py-name">b64decode</tt> </tt>
<a name="L72"></a><tt class="py-lineno"> 72</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">pickle</tt> <tt class="py-keyword">import</tt> <tt class="py-name">loads</tt> </tt>
<a name="L73"></a><tt class="py-lineno"> 73</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">numpy</tt> <tt class="py-keyword">import</tt> <tt class="py-name">percentile</tt><tt class="py-op">,</tt> <tt class="py-name">asarray</tt><tt class="py-op">,</tt> <tt class="py-name">arange</tt><tt class="py-op">,</tt> <tt class="py-name">zeros</tt><tt class="py-op">,</tt> <tt class="py-name">where</tt><tt class="py-op">,</tt> <tt class="py-name">repeat</tt><tt class="py-op">,</tt> <tt class="py-name">sort</tt><tt class="py-op">,</tt> <tt class="py-name">cov</tt><tt class="py-op">,</tt> <tt class="py-name">mean</tt><tt class="py-op">,</tt> <tt class="py-name">std</tt><tt class="py-op">,</tt> <tt class="py-name">ceil</tt> </tt>
<a name="L74"></a><tt class="py-lineno"> 74</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">numpy</tt> <tt class="py-keyword">import</tt> <tt class="py-name">vstack</tt><tt class="py-op">,</tt> <tt class="py-name">hstack</tt><tt class="py-op">,</tt> <tt class="py-name">argmin</tt><tt class="py-op">,</tt> <tt class="py-name">ones</tt><tt class="py-op">,</tt> <tt class="py-name">convolve</tt><tt class="py-op">,</tt> <tt class="py-name">log</tt><tt class="py-op">,</tt> <tt class="py-name">linspace</tt><tt class="py-op">,</tt> <tt class="py-name">min</tt><tt class="py-op">,</tt> <tt class="py-name">max</tt><tt class="py-op">,</tt> <tt class="py-name">square</tt><tt class="py-op">,</tt> <tt class="py-name">sum</tt><tt class="py-op">,</tt> <tt class="py-name">diff</tt> </tt>
<a name="L75"></a><tt class="py-lineno"> 75</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">numpy</tt> <tt class="py-keyword">import</tt> <tt class="py-name">corrcoef</tt><tt class="py-op">,</tt> <tt class="py-name">array</tt><tt class="py-op">,</tt> <tt class="py-name">eye</tt><tt class="py-op">,</tt> <tt class="py-name">dot</tt><tt class="py-op">,</tt> <tt class="py-name">empty_like</tt> </tt>
<a name="L76"></a><tt class="py-lineno"> 76</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">numpy</tt><tt class="py-op">.</tt><tt class="py-name">random</tt> <tt class="py-keyword">import</tt> <tt class="py-name">rand</tt> </tt>
<a name="L77"></a><tt class="py-lineno"> 77</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">scipy</tt><tt class="py-op">.</tt><tt class="py-name">signal</tt> <tt class="py-keyword">import</tt> <tt class="py-name">resample</tt> </tt>
<a name="L78"></a><tt class="py-lineno"> 78</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">scipy</tt><tt class="py-op">.</tt><tt class="py-name">stats</tt> <tt class="py-keyword">import</tt> <tt class="py-name">poisson</tt> </tt>
<a name="L79"></a><tt class="py-lineno"> 79</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">scipy</tt><tt class="py-op">.</tt><tt class="py-name">stats</tt><tt class="py-op">.</tt><tt class="py-name">mstats</tt> <tt class="py-keyword">import</tt> <tt class="py-name">gmean</tt> </tt>
<a name="L80"></a><tt class="py-lineno"> 80</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">scipy</tt><tt class="py-op">.</tt><tt class="py-name">interpolate</tt> <tt class="py-keyword">import</tt> <tt class="py-name">interp1d</tt> </tt>
<a name="L81"></a><tt class="py-lineno"> 81</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">scipy</tt><tt class="py-op">.</tt><tt class="py-name">optimize</tt> <tt class="py-keyword">import</tt> <tt class="py-name">minimize</tt> </tt>
<a name="L82"></a><tt class="py-lineno"> 82</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">cmt</tt><tt class="py-op">.</tt><tt class="py-name">models</tt> <tt class="py-keyword">import</tt> <tt class="py-name">MCGSM</tt><tt class="py-op">,</tt> <tt class="py-name">STM</tt><tt class="py-op">,</tt> <tt class="py-name">Poisson</tt> </tt>
<a name="L83"></a><tt class="py-lineno"> 83</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">cmt</tt><tt class="py-op">.</tt><tt class="py-name">nonlinear</tt> <tt class="py-keyword">import</tt> <tt class="py-name">ExponentialFunction</tt><tt class="py-op">,</tt> <tt class="py-name">BlobNonlinearity</tt> </tt>
<a name="L84"></a><tt class="py-lineno"> 84</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">cmt</tt><tt class="py-op">.</tt><tt class="py-name">tools</tt> <tt class="py-keyword">import</tt> <tt class="py-name">generate_data_from_image</tt><tt class="py-op">,</tt> <tt class="py-name">extract_windows</tt> </tt>
<a name="L85"></a><tt class="py-lineno"> 85</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">cmt</tt><tt class="py-op">.</tt><tt class="py-name">transforms</tt> <tt class="py-keyword">import</tt> <tt class="py-name">PCATransform</tt> </tt>
<a name="L86"></a><tt class="py-lineno"> 86</tt>  <tt class="py-line"><tt class="py-keyword">from</tt> <tt class="py-name">cmt</tt><tt class="py-op">.</tt><tt class="py-name">utils</tt> <tt class="py-keyword">import</tt> <tt class="py-name">random_select</tt> </tt>
<a name="L87"></a><tt class="py-lineno"> 87</tt>  <tt class="py-line"> </tt>
<a name="L88"></a><tt class="py-lineno"> 88</tt>  <tt class="py-line"><tt class="py-keyword">try</tt><tt class="py-op">:</tt> </tt>
<a name="L89"></a><tt class="py-lineno"> 89</tt>  <tt class="py-line">        <tt class="py-keyword">from</tt> <tt class="py-name">roc</tt> <tt class="py-keyword">import</tt> <tt class="py-name">roc</tt> </tt>
<a name="L90"></a><tt class="py-lineno"> 90</tt>  <tt class="py-line"><tt class="py-keyword">except</tt><tt class="py-op">:</tt> </tt>
<a name="L91"></a><tt class="py-lineno"> 91</tt>  <tt class="py-line">        <tt class="py-keyword">pass</tt> </tt>
<a name="L92"></a><tt class="py-lineno"> 92</tt>  <tt class="py-line"> </tt>
<a name="preprocess"></a><div id="preprocess-def"><a name="L93"></a><tt class="py-lineno"> 93</tt> <a class="py-toggle" href="#" id="preprocess-toggle" onclick="return toggle('preprocess');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="c2s.c2s-module.html#preprocess">preprocess</a><tt class="py-op">(</tt><tt class="py-param">data</tt><tt class="py-op">,</tt> <tt class="py-param">fps</tt><tt class="py-op">=</tt><tt class="py-number">100.</tt><tt class="py-op">,</tt> <tt class="py-param">filter</tt><tt class="py-op">=</tt><tt class="py-name">None</tt><tt class="py-op">,</tt> <tt class="py-param">verbosity</tt><tt class="py-op">=</tt><tt class="py-number">0</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="preprocess-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="preprocess-expanded"><a name="L94"></a><tt class="py-lineno"> 94</tt>  <tt class="py-line">        <tt class="py-docstring">"""</tt> </tt>
<a name="L95"></a><tt class="py-lineno"> 95</tt>  <tt class="py-line"><tt class="py-docstring">        Normalize calcium traces and spike trains.</tt> </tt>
<a name="L96"></a><tt class="py-lineno"> 96</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L97"></a><tt class="py-lineno"> 97</tt>  <tt class="py-line"><tt class="py-docstring">        This function does three things:</tt> </tt>
<a name="L98"></a><tt class="py-lineno"> 98</tt>  <tt class="py-line"><tt class="py-docstring">                1. Remove any linear trends using robust linear regression.</tt> </tt>
<a name="L99"></a><tt class="py-lineno"> 99</tt>  <tt class="py-line"><tt class="py-docstring">                2. Normalize the range of the calcium trace by the 5th and 80th percentile.</tt> </tt>
<a name="L100"></a><tt class="py-lineno">100</tt>  <tt class="py-line"><tt class="py-docstring">                3. Change the sampling rate of the calcium trace and spike train.</tt> </tt>
<a name="L101"></a><tt class="py-lineno">101</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L102"></a><tt class="py-lineno">102</tt>  <tt class="py-line"><tt class="py-docstring">        If C{filter} is set, the first step is replaced by estimating and removing a baseline using</tt> </tt>
<a name="L103"></a><tt class="py-lineno">103</tt>  <tt class="py-line"><tt class="py-docstring">        a percentile filter (40 seconds seems like a good value for the percentile filter).</tt> </tt>
<a name="L104"></a><tt class="py-lineno">104</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L105"></a><tt class="py-lineno">105</tt>  <tt class="py-line"><tt class="py-docstring">        @type  data: list</tt> </tt>
<a name="L106"></a><tt class="py-lineno">106</tt>  <tt class="py-line"><tt class="py-docstring">        @param data: list of dictionaries containing calcium/fluorescence traces</tt> </tt>
<a name="L107"></a><tt class="py-lineno">107</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L108"></a><tt class="py-lineno">108</tt>  <tt class="py-line"><tt class="py-docstring">        @type  fps: float</tt> </tt>
<a name="L109"></a><tt class="py-lineno">109</tt>  <tt class="py-line"><tt class="py-docstring">        @param fps: desired sampling rate of signals</tt> </tt>
<a name="L110"></a><tt class="py-lineno">110</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L111"></a><tt class="py-lineno">111</tt>  <tt class="py-line"><tt class="py-docstring">        @type  filter: float/None</tt> </tt>
<a name="L112"></a><tt class="py-lineno">112</tt>  <tt class="py-line"><tt class="py-docstring">        @param filter: number of seconds used in percentile filter</tt> </tt>
<a name="L113"></a><tt class="py-lineno">113</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L114"></a><tt class="py-lineno">114</tt>  <tt class="py-line"><tt class="py-docstring">        @type  verbosity: int</tt> </tt>
<a name="L115"></a><tt class="py-lineno">115</tt>  <tt class="py-line"><tt class="py-docstring">        @param verbosity: if positive, print messages indicating progress</tt> </tt>
<a name="L116"></a><tt class="py-lineno">116</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L117"></a><tt class="py-lineno">117</tt>  <tt class="py-line"><tt class="py-docstring">        @rtype: list</tt> </tt>
<a name="L118"></a><tt class="py-lineno">118</tt>  <tt class="py-line"><tt class="py-docstring">        @return: list of preprocessed recordings</tt> </tt>
<a name="L119"></a><tt class="py-lineno">119</tt>  <tt class="py-line"><tt class="py-docstring">        """</tt> </tt>
<a name="L120"></a><tt class="py-lineno">120</tt>  <tt class="py-line"> </tt>
<a name="L121"></a><tt class="py-lineno">121</tt>  <tt class="py-line">        <tt class="py-name">data</tt> <tt class="py-op">=</tt> <tt class="py-name">deepcopy</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> </tt>
<a name="L122"></a><tt class="py-lineno">122</tt>  <tt class="py-line"> </tt>
<a name="L123"></a><tt class="py-lineno">123</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">k</tt> <tt class="py-keyword">in</tt> <tt class="py-name">range</tt><tt class="py-op">(</tt><tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L124"></a><tt class="py-lineno">124</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L125"></a><tt class="py-lineno">125</tt>  <tt class="py-line">                        <tt class="py-keyword">print</tt> <tt class="py-string">'Preprocessing calcium trace {0}...'</tt><tt class="py-op">.</tt><tt class="py-name">format</tt><tt class="py-op">(</tt><tt class="py-name">k</tt><tt class="py-op">)</tt> </tt>
<a name="L126"></a><tt class="py-lineno">126</tt>  <tt class="py-line"> </tt>
<a name="L127"></a><tt class="py-lineno">127</tt>  <tt class="py-line">                <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">float</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L128"></a><tt class="py-lineno">128</tt>  <tt class="py-line"> </tt>
<a name="L129"></a><tt class="py-lineno">129</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">filter</tt> <tt class="py-keyword">is</tt> <tt class="py-name">None</tt><tt class="py-op">:</tt> </tt>
<a name="L130"></a><tt class="py-lineno">130</tt>  <tt class="py-line">                        <tt class="py-comment"># remove any linear trends</tt> </tt>
<a name="L131"></a><tt class="py-lineno">131</tt>  <tt class="py-line">                        <tt class="py-name">x</tt> <tt class="py-op">=</tt> <tt class="py-name">arange</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">size</tt><tt class="py-op">)</tt> </tt>
<a name="L132"></a><tt class="py-lineno">132</tt>  <tt class="py-line">                        <tt class="py-name">a</tt><tt class="py-op">,</tt> <tt class="py-name">b</tt> <tt class="py-op">=</tt> <tt class="py-name">robust_linear_regression</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">,</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L133"></a><tt class="py-lineno">133</tt>  <tt class="py-line"> </tt>
<a name="L134"></a><tt class="py-lineno">134</tt>  <tt class="py-line">                        <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt> <tt class="py-op">-</tt> <tt class="py-op">(</tt><tt class="py-name">a</tt> <tt class="py-op">*</tt> <tt class="py-name">x</tt> <tt class="py-op">+</tt> <tt class="py-name">b</tt><tt class="py-op">)</tt> </tt>
<a name="L135"></a><tt class="py-lineno">135</tt>  <tt class="py-line">                <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L136"></a><tt class="py-lineno">136</tt>  <tt class="py-line">                        <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt> <tt class="py-op">-</tt> \ </tt>
<a name="L137"></a><tt class="py-lineno">137</tt>  <tt class="py-line">                                <tt class="py-name">percentile_filter</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">window_length</tt><tt class="py-op">=</tt><tt class="py-name">int</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt> <tt class="py-op">*</tt> <tt class="py-name">filter</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">perc</tt><tt class="py-op">=</tt><tt class="py-number">5</tt><tt class="py-op">)</tt> </tt>
<a name="L138"></a><tt class="py-lineno">138</tt>  <tt class="py-line"> </tt>
<a name="L139"></a><tt class="py-lineno">139</tt>  <tt class="py-line">                <tt class="py-comment"># normalize dispersion</tt> </tt>
<a name="L140"></a><tt class="py-lineno">140</tt>  <tt class="py-line">                <tt class="py-name">calcium05</tt> <tt class="py-op">=</tt> <tt class="py-name">percentile</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt>  <tt class="py-number">5</tt><tt class="py-op">)</tt> </tt>
<a name="L141"></a><tt class="py-lineno">141</tt>  <tt class="py-line">                <tt class="py-name">calcium80</tt> <tt class="py-op">=</tt> <tt class="py-name">percentile</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-number">80</tt><tt class="py-op">)</tt> </tt>
<a name="L142"></a><tt class="py-lineno">142</tt>  <tt class="py-line"> </tt>
<a name="L143"></a><tt class="py-lineno">143</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">calcium80</tt> <tt class="py-op">-</tt> <tt class="py-name">calcium05</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0.</tt><tt class="py-op">:</tt> </tt>
<a name="L144"></a><tt class="py-lineno">144</tt>  <tt class="py-line">                        <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt> <tt class="py-op">-</tt> <tt class="py-name">calcium05</tt><tt class="py-op">)</tt> <tt class="py-op">/</tt> <tt class="py-name">float</tt><tt class="py-op">(</tt><tt class="py-name">calcium80</tt> <tt class="py-op">-</tt> <tt class="py-name">calcium05</tt><tt class="py-op">)</tt> </tt>
<a name="L145"></a><tt class="py-lineno">145</tt>  <tt class="py-line"> </tt>
<a name="L146"></a><tt class="py-lineno">146</tt>  <tt class="py-line">                <tt class="py-comment"># compute spike times if binned spikes are given</tt> </tt>
<a name="L147"></a><tt class="py-lineno">147</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-string">'spikes'</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt> <tt class="py-keyword">and</tt> <tt class="py-string">'spike_times'</tt> <tt class="py-keyword">not</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">:</tt> </tt>
<a name="L148"></a><tt class="py-lineno">148</tt>  <tt class="py-line">                        <tt class="py-name">spikes</tt> <tt class="py-op">=</tt> <tt class="py-name">asarray</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'spikes'</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">ravel</tt><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">dtype</tt><tt class="py-op">=</tt><tt class="py-string">'uint16'</tt><tt class="py-op">)</tt> </tt>
<a name="L149"></a><tt class="py-lineno">149</tt>  <tt class="py-line"> </tt>
<a name="L150"></a><tt class="py-lineno">150</tt>  <tt class="py-line">                        <tt class="py-comment"># compute spike times in milliseconds</tt> </tt>
<a name="L151"></a><tt class="py-lineno">151</tt>  <tt class="py-line">                        <tt class="py-name">spike_times</tt> <tt class="py-op">=</tt> <tt class="py-name">where</tt><tt class="py-op">(</tt><tt class="py-name">spikes</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt> </tt>
<a name="L152"></a><tt class="py-lineno">152</tt>  <tt class="py-line">                        <tt class="py-name">spike_times</tt> <tt class="py-op">=</tt> <tt class="py-name">repeat</tt><tt class="py-op">(</tt><tt class="py-name">spike_times</tt><tt class="py-op">,</tt> <tt class="py-name">spikes</tt><tt class="py-op">[</tt><tt class="py-name">spike_times</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L153"></a><tt class="py-lineno">153</tt>  <tt class="py-line">                        <tt class="py-name">spike_times</tt> <tt class="py-op">=</tt> <tt class="py-op">(</tt><tt class="py-name">spike_times</tt> <tt class="py-op">+</tt> <tt class="py-name">rand</tt><tt class="py-op">(</tt><tt class="py-op">*</tt><tt class="py-name">spike_times</tt><tt class="py-op">.</tt><tt class="py-name">shape</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-op">*</tt> <tt class="py-op">(</tt><tt class="py-number">1000.</tt> <tt class="py-op">/</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L154"></a><tt class="py-lineno">154</tt>  <tt class="py-line"> </tt>
<a name="L155"></a><tt class="py-lineno">155</tt>  <tt class="py-line">                        <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'spike_times'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">sort</tt><tt class="py-op">(</tt><tt class="py-name">spike_times</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">reshape</tt><tt class="py-op">(</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">)</tt> </tt>
<a name="L156"></a><tt class="py-lineno">156</tt>  <tt class="py-line"> </tt>
<a name="L157"></a><tt class="py-lineno">157</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">fps</tt> <tt class="py-keyword">is</tt> <tt class="py-keyword">not</tt> <tt class="py-name">None</tt> <tt class="py-keyword">and</tt> <tt class="py-name">fps</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0.</tt><tt class="py-op">:</tt> </tt>
<a name="L158"></a><tt class="py-lineno">158</tt>  <tt class="py-line">                        <tt class="py-comment"># number of samples after update of sampling rate</tt> </tt>
<a name="L159"></a><tt class="py-lineno">159</tt>  <tt class="py-line">                        <tt class="py-name">num_samples</tt> <tt class="py-op">=</tt> <tt class="py-name">int</tt><tt class="py-op">(</tt><tt class="py-name">float</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">size</tt><tt class="py-op">)</tt> <tt class="py-op">*</tt> <tt class="py-name">fps</tt> <tt class="py-op">/</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt> <tt class="py-op">+</tt> <tt class="py-number">.5</tt><tt class="py-op">)</tt> </tt>
<a name="L160"></a><tt class="py-lineno">160</tt>  <tt class="py-line"> </tt>
<a name="L161"></a><tt class="py-lineno">161</tt>  <tt class="py-line">                        <tt class="py-keyword">if</tt> <tt class="py-name">num_samples</tt> <tt class="py-op">!=</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">size</tt><tt class="py-op">:</tt> </tt>
<a name="L162"></a><tt class="py-lineno">162</tt>  <tt class="py-line">                                <tt class="py-comment"># factor by which number of samples will actually be changed</tt> </tt>
<a name="L163"></a><tt class="py-lineno">163</tt>  <tt class="py-line">                                <tt class="py-name">factor</tt> <tt class="py-op">=</tt> <tt class="py-name">num_samples</tt> <tt class="py-op">/</tt> <tt class="py-name">float</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">size</tt><tt class="py-op">)</tt> </tt>
<a name="L164"></a><tt class="py-lineno">164</tt>  <tt class="py-line"> </tt>
<a name="L165"></a><tt class="py-lineno">165</tt>  <tt class="py-line">                                <tt class="py-comment"># resample calcium signal</tt> </tt>
<a name="L166"></a><tt class="py-lineno">166</tt>  <tt class="py-line">                                <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">resample</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">ravel</tt><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">num_samples</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">reshape</tt><tt class="py-op">(</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">)</tt> </tt>
<a name="L167"></a><tt class="py-lineno">167</tt>  <tt class="py-line">                                <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt> <tt class="py-op">*</tt> <tt class="py-name">factor</tt> </tt>
<a name="L168"></a><tt class="py-lineno">168</tt>  <tt class="py-line">                <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L169"></a><tt class="py-lineno">169</tt>  <tt class="py-line">                        <tt class="py-comment"># don't change sampling rate</tt> </tt>
<a name="L170"></a><tt class="py-lineno">170</tt>  <tt class="py-line">                        <tt class="py-name">num_samples</tt> <tt class="py-op">=</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">size</tt> </tt>
<a name="L171"></a><tt class="py-lineno">171</tt>  <tt class="py-line"> </tt>
<a name="L172"></a><tt class="py-lineno">172</tt>  <tt class="py-line">                <tt class="py-comment"># compute binned spike trains if missing</tt> </tt>
<a name="L173"></a><tt class="py-lineno">173</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-string">'spike_times'</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt> <tt class="py-keyword">and</tt> <tt class="py-op">(</tt><tt class="py-string">'spikes'</tt> <tt class="py-keyword">not</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt> <tt class="py-keyword">or</tt> <tt class="py-name">num_samples</tt> <tt class="py-op">!=</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'spikes'</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">size</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L174"></a><tt class="py-lineno">174</tt>  <tt class="py-line">                        <tt class="py-comment"># spike times in bins</tt> </tt>
<a name="L175"></a><tt class="py-lineno">175</tt>  <tt class="py-line">                        <tt class="py-name">spike_times</tt> <tt class="py-op">=</tt> <tt class="py-name">asarray</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'spike_times'</tt><tt class="py-op">]</tt> <tt class="py-op">*</tt> <tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt> <tt class="py-op">/</tt> <tt class="py-number">1000.</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">dtype</tt><tt class="py-op">=</tt><tt class="py-name">int</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">ravel</tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L176"></a><tt class="py-lineno">176</tt>  <tt class="py-line">                        <tt class="py-name">spike_times</tt> <tt class="py-op">=</tt> <tt class="py-name">spike_times</tt><tt class="py-op">[</tt><tt class="py-name">spike_times</tt> <tt class="py-op">&lt;</tt> <tt class="py-name">num_samples</tt><tt class="py-op">]</tt> </tt>
<a name="L177"></a><tt class="py-lineno">177</tt>  <tt class="py-line">                        <tt class="py-name">spike_times</tt> <tt class="py-op">=</tt> <tt class="py-name">spike_times</tt><tt class="py-op">[</tt><tt class="py-name">spike_times</tt> <tt class="py-op">&gt;=</tt> <tt class="py-number">0</tt><tt class="py-op">]</tt> </tt>
<a name="L178"></a><tt class="py-lineno">178</tt>  <tt class="py-line"> </tt>
<a name="L179"></a><tt class="py-lineno">179</tt>  <tt class="py-line">                        <tt class="py-comment"># create binned spike train</tt> </tt>
<a name="L180"></a><tt class="py-lineno">180</tt>  <tt class="py-line">                        <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'spikes'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">zeros</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-name">num_samples</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">dtype</tt><tt class="py-op">=</tt><tt class="py-string">'uint16'</tt><tt class="py-op">)</tt> </tt>
<a name="L181"></a><tt class="py-lineno">181</tt>  <tt class="py-line">                        <tt class="py-keyword">for</tt> <tt class="py-name">t</tt> <tt class="py-keyword">in</tt> <tt class="py-name">spike_times</tt><tt class="py-op">:</tt> </tt>
<a name="L182"></a><tt class="py-lineno">182</tt>  <tt class="py-line">                                <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'spikes'</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">,</tt> <tt class="py-name">t</tt><tt class="py-op">]</tt> <tt class="py-op">+=</tt> <tt class="py-number">1</tt> </tt>
<a name="L183"></a><tt class="py-lineno">183</tt>  <tt class="py-line"> </tt>
<a name="L184"></a><tt class="py-lineno">184</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt> <tt class="py-name">data</tt> </tt>
</div><a name="L185"></a><tt class="py-lineno">185</tt>  <tt class="py-line"> </tt>
<a name="L186"></a><tt class="py-lineno">186</tt>  <tt class="py-line"> </tt>
<a name="L187"></a><tt class="py-lineno">187</tt>  <tt class="py-line"> </tt>
<a name="train"></a><div id="train-def"><a name="L188"></a><tt class="py-lineno">188</tt> <a class="py-toggle" href="#" id="train-toggle" onclick="return toggle('train');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="c2s.c2s-module.html#train">train</a><tt class="py-op">(</tt><tt class="py-param">data</tt><tt class="py-op">,</tt> </tt>
<a name="L189"></a><tt class="py-lineno">189</tt>  <tt class="py-line">                <tt class="py-param">num_valid</tt><tt class="py-op">=</tt><tt class="py-number">0</tt><tt class="py-op">,</tt> </tt>
<a name="L190"></a><tt class="py-lineno">190</tt>  <tt class="py-line">                <tt class="py-param">num_models</tt><tt class="py-op">=</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> </tt>
<a name="L191"></a><tt class="py-lineno">191</tt>  <tt class="py-line">                <tt class="py-param">var_explained</tt><tt class="py-op">=</tt><tt class="py-number">95.</tt><tt class="py-op">,</tt> </tt>
<a name="L192"></a><tt class="py-lineno">192</tt>  <tt class="py-line">                <tt class="py-param">window_length</tt><tt class="py-op">=</tt><tt class="py-number">1000.</tt><tt class="py-op">,</tt> </tt>
<a name="L193"></a><tt class="py-lineno">193</tt>  <tt class="py-line">                <tt class="py-param">finetune</tt><tt class="py-op">=</tt><tt class="py-name">False</tt><tt class="py-op">,</tt> </tt>
<a name="L194"></a><tt class="py-lineno">194</tt>  <tt class="py-line">                <tt class="py-param">keep_all</tt><tt class="py-op">=</tt><tt class="py-name">True</tt><tt class="py-op">,</tt> </tt>
<a name="L195"></a><tt class="py-lineno">195</tt>  <tt class="py-line">                <tt class="py-param">verbosity</tt><tt class="py-op">=</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> </tt>
<a name="L196"></a><tt class="py-lineno">196</tt>  <tt class="py-line">                <tt class="py-param">model_parameters</tt><tt class="py-op">=</tt><tt class="py-op">{</tt><tt class="py-op">}</tt><tt class="py-op">,</tt> </tt>
<a name="L197"></a><tt class="py-lineno">197</tt>  <tt class="py-line">                <tt class="py-param">training_parameters</tt><tt class="py-op">=</tt><tt class="py-op">{</tt><tt class="py-op">}</tt><tt class="py-op">,</tt> </tt>
<a name="L198"></a><tt class="py-lineno">198</tt>  <tt class="py-line">                <tt class="py-param">regularize</tt><tt class="py-op">=</tt><tt class="py-number">0.</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="train-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="train-expanded"><a name="L199"></a><tt class="py-lineno">199</tt>  <tt class="py-line">        <tt class="py-docstring">"""</tt> </tt>
<a name="L200"></a><tt class="py-lineno">200</tt>  <tt class="py-line"><tt class="py-docstring">        Trains models on the task of predicting spike trains from calcium traces.</tt> </tt>
<a name="L201"></a><tt class="py-lineno">201</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L202"></a><tt class="py-lineno">202</tt>  <tt class="py-line"><tt class="py-docstring">        This function takes a dataset and trains one or several models (STMs) to predict spikes</tt> </tt>
<a name="L203"></a><tt class="py-lineno">203</tt>  <tt class="py-line"><tt class="py-docstring">        from calcium signals. By default, the method trains a single model on 1000ms windows</tt> </tt>
<a name="L204"></a><tt class="py-lineno">204</tt>  <tt class="py-line"><tt class="py-docstring">        extracted from the calcium (fluorescence) traces.</tt> </tt>
<a name="L205"></a><tt class="py-lineno">205</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L206"></a><tt class="py-lineno">206</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt; results = train(data)</tt> </tt>
<a name="L207"></a><tt class="py-lineno">207</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L208"></a><tt class="py-lineno">208</tt>  <tt class="py-line"><tt class="py-docstring">        See above for an explanation of the expected data format. A more detailed example:</tt> </tt>
<a name="L209"></a><tt class="py-lineno">209</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L210"></a><tt class="py-lineno">210</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt; results = train(data,</tt> </tt>
<a name="L211"></a><tt class="py-lineno">211</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt;     num_models=4,</tt> </tt>
<a name="L212"></a><tt class="py-lineno">212</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt;     var_explained=98.,</tt> </tt>
<a name="L213"></a><tt class="py-lineno">213</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt;     window_length=800.,</tt> </tt>
<a name="L214"></a><tt class="py-lineno">214</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt;     model_parameters={</tt> </tt>
<a name="L215"></a><tt class="py-lineno">215</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt;             'num_components': 3,</tt> </tt>
<a name="L216"></a><tt class="py-lineno">216</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt;             'num_features': 2},</tt> </tt>
<a name="L217"></a><tt class="py-lineno">217</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt;     training_parameters={</tt> </tt>
<a name="L218"></a><tt class="py-lineno">218</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt;             'max_iter': 3000,</tt> </tt>
<a name="L219"></a><tt class="py-lineno">219</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt;             'threshold': 1e-9})</tt> </tt>
<a name="L220"></a><tt class="py-lineno">220</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L221"></a><tt class="py-lineno">221</tt>  <tt class="py-line"><tt class="py-docstring">        For an explanation on the model and training parameters, please see the</tt> </tt>
<a name="L222"></a><tt class="py-lineno">222</tt>  <tt class="py-line"><tt class="py-docstring">        U{CMT documentation&lt;http://lucastheis.github.io/cmt/&gt;}. The training procedure</tt> </tt>
<a name="L223"></a><tt class="py-lineno">223</tt>  <tt class="py-line"><tt class="py-docstring">        returns a dictionary containing the trained models, and things needed for handling</tt> </tt>
<a name="L224"></a><tt class="py-lineno">224</tt>  <tt class="py-line"><tt class="py-docstring">        and preprocessing calcium traces.</tt> </tt>
<a name="L225"></a><tt class="py-lineno">225</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L226"></a><tt class="py-lineno">226</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt; results['models']</tt> </tt>
<a name="L227"></a><tt class="py-lineno">227</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt; results['pca']</tt> </tt>
<a name="L228"></a><tt class="py-lineno">228</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt; results['input_mask']</tt> </tt>
<a name="L229"></a><tt class="py-lineno">229</tt>  <tt class="py-line"><tt class="py-docstring">                &gt;&gt;&gt; results['output_mask']</tt> </tt>
<a name="L230"></a><tt class="py-lineno">230</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L231"></a><tt class="py-lineno">231</tt>  <tt class="py-line"><tt class="py-docstring">        @see: L{predict&lt;c2s.predict&gt;}</tt> </tt>
<a name="L232"></a><tt class="py-lineno">232</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L233"></a><tt class="py-lineno">233</tt>  <tt class="py-line"><tt class="py-docstring">        @type  data: list</tt> </tt>
<a name="L234"></a><tt class="py-lineno">234</tt>  <tt class="py-line"><tt class="py-docstring">        @param data: list of dictionaries containig calcium/fluorescence traces</tt> </tt>
<a name="L235"></a><tt class="py-lineno">235</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L236"></a><tt class="py-lineno">236</tt>  <tt class="py-line"><tt class="py-docstring">        @type  num_valid: int</tt> </tt>
<a name="L237"></a><tt class="py-lineno">237</tt>  <tt class="py-line"><tt class="py-docstring">        @param num_valid: number of cells used for early stopping based on a validation set</tt> </tt>
<a name="L238"></a><tt class="py-lineno">238</tt>  <tt class="py-line"><tt class="py-docstring">        </tt> </tt>
<a name="L239"></a><tt class="py-lineno">239</tt>  <tt class="py-line"><tt class="py-docstring">        @type  num_models: int</tt> </tt>
<a name="L240"></a><tt class="py-lineno">240</tt>  <tt class="py-line"><tt class="py-docstring">        @param num_models: to counter local optima and other randomness, multiple models can be trained</tt> </tt>
<a name="L241"></a><tt class="py-lineno">241</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L242"></a><tt class="py-lineno">242</tt>  <tt class="py-line"><tt class="py-docstring">        @type  var_explained: float</tt> </tt>
<a name="L243"></a><tt class="py-lineno">243</tt>  <tt class="py-line"><tt class="py-docstring">        @param var_explained: controls the number of principal components used to represent calcium window</tt> </tt>
<a name="L244"></a><tt class="py-lineno">244</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L245"></a><tt class="py-lineno">245</tt>  <tt class="py-line"><tt class="py-docstring">        @type  window_length: int</tt> </tt>
<a name="L246"></a><tt class="py-lineno">246</tt>  <tt class="py-line"><tt class="py-docstring">        @param window_length: size of calcium window used as input to STM (in milliseconds)</tt> </tt>
<a name="L247"></a><tt class="py-lineno">247</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L248"></a><tt class="py-lineno">248</tt>  <tt class="py-line"><tt class="py-docstring">        @type  finetune: bool</tt> </tt>
<a name="L249"></a><tt class="py-lineno">249</tt>  <tt class="py-line"><tt class="py-docstring">        @param finetune: if True, replace nonlinearity with BlobNonlinearity in second optimization step</tt> </tt>
<a name="L250"></a><tt class="py-lineno">250</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L251"></a><tt class="py-lineno">251</tt>  <tt class="py-line"><tt class="py-docstring">        @type  keep_all: bool</tt> </tt>
<a name="L252"></a><tt class="py-lineno">252</tt>  <tt class="py-line"><tt class="py-docstring">        @param keep_all: if False, only keep the best of all trained models</tt> </tt>
<a name="L253"></a><tt class="py-lineno">253</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L254"></a><tt class="py-lineno">254</tt>  <tt class="py-line"><tt class="py-docstring">        @type  regularize: float</tt> </tt>
<a name="L255"></a><tt class="py-lineno">255</tt>  <tt class="py-line"><tt class="py-docstring">        @param regularize: strength with which model filters are regularized for smoothness</tt> </tt>
<a name="L256"></a><tt class="py-lineno">256</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L257"></a><tt class="py-lineno">257</tt>  <tt class="py-line"><tt class="py-docstring">        @rtype: dict</tt> </tt>
<a name="L258"></a><tt class="py-lineno">258</tt>  <tt class="py-line"><tt class="py-docstring">        @return: dictionary containing trained models and things needed for preprocessing</tt> </tt>
<a name="L259"></a><tt class="py-lineno">259</tt>  <tt class="py-line"><tt class="py-docstring">        """</tt> </tt>
<a name="L260"></a><tt class="py-lineno">260</tt>  <tt class="py-line"> </tt>
<a name="L261"></a><tt class="py-lineno">261</tt>  <tt class="py-line">        <tt class="py-name">model_parameters</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'num_components'</tt><tt class="py-op">,</tt> <tt class="py-number">3</tt><tt class="py-op">)</tt> </tt>
<a name="L262"></a><tt class="py-lineno">262</tt>  <tt class="py-line">        <tt class="py-name">model_parameters</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'num_features'</tt><tt class="py-op">,</tt> <tt class="py-number">2</tt><tt class="py-op">)</tt> </tt>
<a name="L263"></a><tt class="py-lineno">263</tt>  <tt class="py-line">        <tt class="py-name">model_parameters</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'nonlinearity'</tt><tt class="py-op">,</tt> <tt class="py-name">ExponentialFunction</tt><tt class="py-op">)</tt> </tt>
<a name="L264"></a><tt class="py-lineno">264</tt>  <tt class="py-line">        <tt class="py-name">model_parameters</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'distribution'</tt><tt class="py-op">,</tt> <tt class="py-name">Poisson</tt><tt class="py-op">)</tt> </tt>
<a name="L265"></a><tt class="py-lineno">265</tt>  <tt class="py-line"> </tt>
<a name="L266"></a><tt class="py-lineno">266</tt>  <tt class="py-line">        <tt class="py-name">training_parameters</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'max_iter'</tt><tt class="py-op">,</tt> <tt class="py-number">3000</tt><tt class="py-op">)</tt> </tt>
<a name="L267"></a><tt class="py-lineno">267</tt>  <tt class="py-line">        <tt class="py-name">training_parameters</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'val_iter'</tt><tt class="py-op">,</tt> <tt class="py-number">1</tt><tt class="py-op">)</tt> </tt>
<a name="L268"></a><tt class="py-lineno">268</tt>  <tt class="py-line">        <tt class="py-name">training_parameters</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'val_look_ahead'</tt><tt class="py-op">,</tt> <tt class="py-number">100</tt><tt class="py-op">)</tt> </tt>
<a name="L269"></a><tt class="py-lineno">269</tt>  <tt class="py-line">        <tt class="py-name">training_parameters</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'threshold'</tt><tt class="py-op">,</tt> <tt class="py-number">1e-9</tt><tt class="py-op">)</tt> </tt>
<a name="L270"></a><tt class="py-lineno">270</tt>  <tt class="py-line"> </tt>
<a name="L271"></a><tt class="py-lineno">271</tt>  <tt class="py-line">        <tt class="py-comment"># turn milliseconds into bins</tt> </tt>
<a name="L272"></a><tt class="py-lineno">272</tt>  <tt class="py-line">        <tt class="py-name">window_length</tt> <tt class="py-op">=</tt> <tt class="py-name">int</tt><tt class="py-op">(</tt><tt class="py-name">ceil</tt><tt class="py-op">(</tt><tt class="py-name">window_length</tt> <tt class="py-op">/</tt> <tt class="py-number">1000.</tt> <tt class="py-op">*</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> <tt class="py-op">+</tt> <tt class="py-number">.5</tt><tt class="py-op">)</tt> <tt class="py-comment"># bins</tt> </tt>
<a name="L273"></a><tt class="py-lineno">273</tt>  <tt class="py-line"> </tt>
<a name="L274"></a><tt class="py-lineno">274</tt>  <tt class="py-line">        <tt class="py-name">input_mask</tt> <tt class="py-op">=</tt> <tt class="py-name">zeros</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-number">2</tt><tt class="py-op">,</tt> <tt class="py-name">window_length</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">dtype</tt><tt class="py-op">=</tt><tt class="py-string">'bool'</tt><tt class="py-op">)</tt> </tt>
<a name="L275"></a><tt class="py-lineno">275</tt>  <tt class="py-line">        <tt class="py-name">input_mask</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">True</tt> </tt>
<a name="L276"></a><tt class="py-lineno">276</tt>  <tt class="py-line"> </tt>
<a name="L277"></a><tt class="py-lineno">277</tt>  <tt class="py-line">        <tt class="py-name">output_mask</tt> <tt class="py-op">=</tt> <tt class="py-name">zeros</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-number">2</tt><tt class="py-op">,</tt> <tt class="py-name">window_length</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">dtype</tt><tt class="py-op">=</tt><tt class="py-string">'bool'</tt><tt class="py-op">)</tt> </tt>
<a name="L278"></a><tt class="py-lineno">278</tt>  <tt class="py-line">        <tt class="py-name">output_mask</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-name">window_length</tt> <tt class="py-op">/</tt> <tt class="py-number">2</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">True</tt> </tt>
<a name="L279"></a><tt class="py-lineno">279</tt>  <tt class="py-line"> </tt>
<a name="L280"></a><tt class="py-lineno">280</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L281"></a><tt class="py-lineno">281</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt> <tt class="py-string">'Extracting inputs and outputs...'</tt> </tt>
<a name="L282"></a><tt class="py-lineno">282</tt>  <tt class="py-line"> </tt>
<a name="L283"></a><tt class="py-lineno">283</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">:</tt> </tt>
<a name="L284"></a><tt class="py-lineno">284</tt>  <tt class="py-line">                <tt class="py-comment"># extract windows from fluorescence trace and corresponding spike counts</tt> </tt>
<a name="L285"></a><tt class="py-lineno">285</tt>  <tt class="py-line">                <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'outputs'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">generate_data_from_image</tt><tt class="py-op">(</tt> </tt>
<a name="L286"></a><tt class="py-lineno">286</tt>  <tt class="py-line">                        <tt class="py-name">vstack</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'spikes'</tt><tt class="py-op">]</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">input_mask</tt><tt class="py-op">,</tt> <tt class="py-name">output_mask</tt><tt class="py-op">)</tt> </tt>
<a name="L287"></a><tt class="py-lineno">287</tt>  <tt class="py-line"> </tt>
<a name="L288"></a><tt class="py-lineno">288</tt>  <tt class="py-line">        <tt class="py-name">inputs</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">)</tt> </tt>
<a name="L289"></a><tt class="py-lineno">289</tt>  <tt class="py-line"> </tt>
<a name="L290"></a><tt class="py-lineno">290</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L291"></a><tt class="py-lineno">291</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt> <tt class="py-string">'Performing PCA...'</tt> </tt>
<a name="L292"></a><tt class="py-lineno">292</tt>  <tt class="py-line"> </tt>
<a name="L293"></a><tt class="py-lineno">293</tt>  <tt class="py-line">        <tt class="py-name">pca</tt> <tt class="py-op">=</tt> <tt class="py-name">PCATransform</tt><tt class="py-op">(</tt><tt class="py-name">inputs</tt><tt class="py-op">,</tt> <tt class="py-name">var_explained</tt><tt class="py-op">=</tt><tt class="py-name">var_explained</tt><tt class="py-op">)</tt> </tt>
<a name="L294"></a><tt class="py-lineno">294</tt>  <tt class="py-line"> </tt>
<a name="L295"></a><tt class="py-lineno">295</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L296"></a><tt class="py-lineno">296</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt> <tt class="py-string">'Reducing dimensionality of data...'</tt> </tt>
<a name="L297"></a><tt class="py-lineno">297</tt>  <tt class="py-line"> </tt>
<a name="L298"></a><tt class="py-lineno">298</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">:</tt> </tt>
<a name="L299"></a><tt class="py-lineno">299</tt>  <tt class="py-line">                <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">pca</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L300"></a><tt class="py-lineno">300</tt>  <tt class="py-line"> </tt>
<a name="L301"></a><tt class="py-lineno">301</tt>  <tt class="py-line">        <tt class="py-name">models</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-op">]</tt> </tt>
<a name="L302"></a><tt class="py-lineno">302</tt>  <tt class="py-line"> </tt>
<a name="L303"></a><tt class="py-lineno">303</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">_</tt> <tt class="py-keyword">in</tt> <tt class="py-name">range</tt><tt class="py-op">(</tt><tt class="py-name">num_models</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L304"></a><tt class="py-lineno">304</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L305"></a><tt class="py-lineno">305</tt>  <tt class="py-line">                        <tt class="py-keyword">print</tt> <tt class="py-string">'Training STM...'</tt> </tt>
<a name="L306"></a><tt class="py-lineno">306</tt>  <tt class="py-line"> </tt>
<a name="L307"></a><tt class="py-lineno">307</tt>  <tt class="py-line">                <tt class="py-name">model</tt> <tt class="py-op">=</tt> <tt class="py-name">STM</tt><tt class="py-op">(</tt> </tt>
<a name="L308"></a><tt class="py-lineno">308</tt>  <tt class="py-line">                        <tt class="py-name">dim_in_nonlinear</tt><tt class="py-op">=</tt><tt class="py-name">pca</tt><tt class="py-op">.</tt><tt class="py-name">dim_in_pre</tt><tt class="py-op">,</tt> </tt>
<a name="L309"></a><tt class="py-lineno">309</tt>  <tt class="py-line">                        <tt class="py-name">dim_in_linear</tt><tt class="py-op">=</tt><tt class="py-number">0</tt><tt class="py-op">,</tt> </tt>
<a name="L310"></a><tt class="py-lineno">310</tt>  <tt class="py-line">                        <tt class="py-op">**</tt><tt class="py-name">model_parameters</tt><tt class="py-op">)</tt> </tt>
<a name="L311"></a><tt class="py-lineno">311</tt>  <tt class="py-line"> </tt>
<a name="L312"></a><tt class="py-lineno">312</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">num_valid</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L313"></a><tt class="py-lineno">313</tt>  <tt class="py-line">                        <tt class="py-name">idx</tt> <tt class="py-op">=</tt> <tt class="py-name">random_select</tt><tt class="py-op">(</tt><tt class="py-name">num_valid</tt><tt class="py-op">,</tt> <tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L314"></a><tt class="py-lineno">314</tt>  <tt class="py-line"> </tt>
<a name="L315"></a><tt class="py-lineno">315</tt>  <tt class="py-line">                        <tt class="py-name">inputs_train</tt>  <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt>  <tt class="py-keyword">for</tt> <tt class="py-name">k</tt><tt class="py-op">,</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">enumerate</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> <tt class="py-keyword">if</tt> <tt class="py-name">k</tt> <tt class="py-keyword">in</tt> <tt class="py-name">idx</tt><tt class="py-op">)</tt> </tt>
<a name="L316"></a><tt class="py-lineno">316</tt>  <tt class="py-line">                        <tt class="py-name">inputs_valid</tt>  <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt>  <tt class="py-keyword">for</tt> <tt class="py-name">k</tt><tt class="py-op">,</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">enumerate</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> <tt class="py-keyword">if</tt> <tt class="py-name">k</tt> <tt class="py-keyword">not</tt> <tt class="py-keyword">in</tt> <tt class="py-name">idx</tt><tt class="py-op">)</tt> </tt>
<a name="L317"></a><tt class="py-lineno">317</tt>  <tt class="py-line">                        <tt class="py-name">outputs_train</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'outputs'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">k</tt><tt class="py-op">,</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">enumerate</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> <tt class="py-keyword">if</tt> <tt class="py-name">k</tt> <tt class="py-keyword">in</tt> <tt class="py-name">idx</tt><tt class="py-op">)</tt> </tt>
<a name="L318"></a><tt class="py-lineno">318</tt>  <tt class="py-line">                        <tt class="py-name">outputs_valid</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'outputs'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">k</tt><tt class="py-op">,</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">enumerate</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> <tt class="py-keyword">if</tt> <tt class="py-name">k</tt> <tt class="py-keyword">not</tt> <tt class="py-keyword">in</tt> <tt class="py-name">idx</tt><tt class="py-op">)</tt> </tt>
<a name="L319"></a><tt class="py-lineno">319</tt>  <tt class="py-line"> </tt>
<a name="L320"></a><tt class="py-lineno">320</tt>  <tt class="py-line">                        <tt class="py-name">inputs_outputs</tt> <tt class="py-op">=</tt> <tt class="py-op">(</tt><tt class="py-name">inputs_train</tt><tt class="py-op">,</tt> <tt class="py-name">outputs_train</tt><tt class="py-op">,</tt> <tt class="py-name">inputs_valid</tt><tt class="py-op">,</tt> <tt class="py-name">outputs_valid</tt><tt class="py-op">)</tt> </tt>
<a name="L321"></a><tt class="py-lineno">321</tt>  <tt class="py-line">                <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L322"></a><tt class="py-lineno">322</tt>  <tt class="py-line">                        <tt class="py-name">inputs</tt>  <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">)</tt> </tt>
<a name="L323"></a><tt class="py-lineno">323</tt>  <tt class="py-line">                        <tt class="py-name">outputs</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'outputs'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">)</tt> </tt>
<a name="L324"></a><tt class="py-lineno">324</tt>  <tt class="py-line"> </tt>
<a name="L325"></a><tt class="py-lineno">325</tt>  <tt class="py-line">                        <tt class="py-name">inputs_outputs</tt> <tt class="py-op">=</tt> <tt class="py-op">(</tt><tt class="py-name">inputs</tt><tt class="py-op">,</tt> <tt class="py-name">outputs</tt><tt class="py-op">)</tt> </tt>
<a name="L326"></a><tt class="py-lineno">326</tt>  <tt class="py-line"> </tt>
<a name="L327"></a><tt class="py-lineno">327</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">regularize</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0.</tt><tt class="py-op">:</tt> </tt>
<a name="L328"></a><tt class="py-lineno">328</tt>  <tt class="py-line">                        <tt class="py-name">transform</tt> <tt class="py-op">=</tt> <tt class="py-name">eye</tt><tt class="py-op">(</tt><tt class="py-name">pca</tt><tt class="py-op">.</tt><tt class="py-name">dim_in</tt><tt class="py-op">)</tt> \ </tt>
<a name="L329"></a><tt class="py-lineno">329</tt>  <tt class="py-line">                                <tt class="py-op">-</tt> <tt class="py-name">eye</tt><tt class="py-op">(</tt><tt class="py-name">pca</tt><tt class="py-op">.</tt><tt class="py-name">dim_in</tt><tt class="py-op">,</tt> <tt class="py-name">pca</tt><tt class="py-op">.</tt><tt class="py-name">dim_in</tt><tt class="py-op">,</tt>  <tt class="py-number">1</tt><tt class="py-op">)</tt> <tt class="py-op">/</tt> <tt class="py-number">2.</tt> \ </tt>
<a name="L330"></a><tt class="py-lineno">330</tt>  <tt class="py-line">                                <tt class="py-op">-</tt> <tt class="py-name">eye</tt><tt class="py-op">(</tt><tt class="py-name">pca</tt><tt class="py-op">.</tt><tt class="py-name">dim_in</tt><tt class="py-op">,</tt> <tt class="py-name">pca</tt><tt class="py-op">.</tt><tt class="py-name">dim_in</tt><tt class="py-op">,</tt> <tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">)</tt> <tt class="py-op">/</tt> <tt class="py-number">2.</tt> </tt>
<a name="L331"></a><tt class="py-lineno">331</tt>  <tt class="py-line">                        <tt class="py-name">transform</tt> <tt class="py-op">=</tt> <tt class="py-name">dot</tt><tt class="py-op">(</tt><tt class="py-name">transform</tt><tt class="py-op">,</tt> <tt class="py-name">pca</tt><tt class="py-op">.</tt><tt class="py-name">pre_in</tt><tt class="py-op">.</tt><tt class="py-name">T</tt><tt class="py-op">)</tt> </tt>
<a name="L332"></a><tt class="py-lineno">332</tt>  <tt class="py-line"> </tt>
<a name="L333"></a><tt class="py-lineno">333</tt>  <tt class="py-line">                        <tt class="py-name">training_parameters</tt><tt class="py-op">[</tt><tt class="py-string">'regularize_predictors'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-op">{</tt> </tt>
<a name="L334"></a><tt class="py-lineno">334</tt>  <tt class="py-line">                                <tt class="py-string">'strength'</tt><tt class="py-op">:</tt> <tt class="py-name">regularize</tt><tt class="py-op">,</tt> </tt>
<a name="L335"></a><tt class="py-lineno">335</tt>  <tt class="py-line">                                <tt class="py-string">'transform'</tt><tt class="py-op">:</tt> <tt class="py-name">transform</tt><tt class="py-op">,</tt> </tt>
<a name="L336"></a><tt class="py-lineno">336</tt>  <tt class="py-line">                                <tt class="py-string">'norm'</tt><tt class="py-op">:</tt> <tt class="py-string">'L1'</tt><tt class="py-op">}</tt> </tt>
<a name="L337"></a><tt class="py-lineno">337</tt>  <tt class="py-line">                        <tt class="py-name">training_parameters</tt><tt class="py-op">[</tt><tt class="py-string">'regularize_features'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-op">{</tt> </tt>
<a name="L338"></a><tt class="py-lineno">338</tt>  <tt class="py-line">                                <tt class="py-string">'strength'</tt><tt class="py-op">:</tt> <tt class="py-name">regularize</tt> <tt class="py-op">/</tt> <tt class="py-number">10.</tt><tt class="py-op">,</tt> </tt>
<a name="L339"></a><tt class="py-lineno">339</tt>  <tt class="py-line">                                <tt class="py-string">'transform'</tt><tt class="py-op">:</tt> <tt class="py-name">transform</tt><tt class="py-op">,</tt> </tt>
<a name="L340"></a><tt class="py-lineno">340</tt>  <tt class="py-line">                                <tt class="py-string">'norm'</tt><tt class="py-op">:</tt> <tt class="py-string">'L1'</tt><tt class="py-op">}</tt> </tt>
<a name="L341"></a><tt class="py-lineno">341</tt>  <tt class="py-line">                         </tt>
<a name="L342"></a><tt class="py-lineno">342</tt>  <tt class="py-line">                <tt class="py-comment"># train model</tt> </tt>
<a name="L343"></a><tt class="py-lineno">343</tt>  <tt class="py-line">                <tt class="py-name">model</tt><tt class="py-op">.</tt><tt id="link-0" class="py-name" targets="Function c2s.c2s.train()=c2s.c2s-module.html#train"><a title="c2s.c2s.train" class="py-name" href="#" onclick="return doclink('link-0', 'train', 'link-0');">train</a></tt><tt class="py-op">(</tt><tt class="py-op">*</tt><tt class="py-name">inputs_outputs</tt><tt class="py-op">,</tt> <tt class="py-name">parameters</tt><tt class="py-op">=</tt><tt class="py-name">training_parameters</tt><tt class="py-op">)</tt> </tt>
<a name="L344"></a><tt class="py-lineno">344</tt>  <tt class="py-line"> </tt>
<a name="L345"></a><tt class="py-lineno">345</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">finetune</tt><tt class="py-op">:</tt> </tt>
<a name="L346"></a><tt class="py-lineno">346</tt>  <tt class="py-line">                        <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L347"></a><tt class="py-lineno">347</tt>  <tt class="py-line">                                <tt class="py-keyword">print</tt> <tt class="py-string">'Finetuning STM...'</tt> </tt>
<a name="L348"></a><tt class="py-lineno">348</tt>  <tt class="py-line"> </tt>
<a name="L349"></a><tt class="py-lineno">349</tt>  <tt class="py-line">                        <tt class="py-comment"># use flexible nonlinearity</tt> </tt>
<a name="L350"></a><tt class="py-lineno">350</tt>  <tt class="py-line">                        <tt class="py-name">model</tt><tt class="py-op">.</tt><tt class="py-name">nonlinearity</tt> <tt class="py-op">=</tt> <tt class="py-name">BlobNonlinearity</tt><tt class="py-op">(</tt><tt class="py-name">num_components</tt><tt class="py-op">=</tt><tt class="py-number">3</tt><tt class="py-op">)</tt> </tt>
<a name="L351"></a><tt class="py-lineno">351</tt>  <tt class="py-line"> </tt>
<a name="L352"></a><tt class="py-lineno">352</tt>  <tt class="py-line">                        <tt class="py-comment"># train only nonlinearity</tt> </tt>
<a name="L353"></a><tt class="py-lineno">353</tt>  <tt class="py-line">                        <tt class="py-name">training_parameters_copy</tt> <tt class="py-op">=</tt> <tt class="py-name">copy</tt><tt class="py-op">(</tt><tt class="py-name">training_parameters</tt><tt class="py-op">)</tt> </tt>
<a name="L354"></a><tt class="py-lineno">354</tt>  <tt class="py-line">                        <tt class="py-name">training_parameters_copy</tt><tt class="py-op">[</tt><tt class="py-string">'train_predictors'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">False</tt> </tt>
<a name="L355"></a><tt class="py-lineno">355</tt>  <tt class="py-line">                        <tt class="py-name">training_parameters_copy</tt><tt class="py-op">[</tt><tt class="py-string">'train_biases'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">False</tt> </tt>
<a name="L356"></a><tt class="py-lineno">356</tt>  <tt class="py-line">                        <tt class="py-name">training_parameters_copy</tt><tt class="py-op">[</tt><tt class="py-string">'train_features'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">False</tt> </tt>
<a name="L357"></a><tt class="py-lineno">357</tt>  <tt class="py-line">                        <tt class="py-name">training_parameters_copy</tt><tt class="py-op">[</tt><tt class="py-string">'train_weights'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">False</tt> </tt>
<a name="L358"></a><tt class="py-lineno">358</tt>  <tt class="py-line">                        <tt class="py-name">training_parameters_copy</tt><tt class="py-op">[</tt><tt class="py-string">'train_nonlinearity'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">True</tt> </tt>
<a name="L359"></a><tt class="py-lineno">359</tt>  <tt class="py-line">                        <tt class="py-name">model</tt><tt class="py-op">.</tt><tt id="link-1" class="py-name"><a title="c2s.c2s.train" class="py-name" href="#" onclick="return doclink('link-1', 'train', 'link-0');">train</a></tt><tt class="py-op">(</tt><tt class="py-op">*</tt><tt class="py-name">inputs_outputs</tt><tt class="py-op">,</tt> <tt class="py-name">parameters</tt><tt class="py-op">=</tt><tt class="py-name">training_parameters_copy</tt><tt class="py-op">)</tt> </tt>
<a name="L360"></a><tt class="py-lineno">360</tt>  <tt class="py-line"> </tt>
<a name="L361"></a><tt class="py-lineno">361</tt>  <tt class="py-line">                        <tt class="py-comment"># train all parameters jointly</tt> </tt>
<a name="L362"></a><tt class="py-lineno">362</tt>  <tt class="py-line">                        <tt class="py-name">training_parameters_copy</tt> <tt class="py-op">=</tt> <tt class="py-name">copy</tt><tt class="py-op">(</tt><tt class="py-name">training_parameters</tt><tt class="py-op">)</tt> </tt>
<a name="L363"></a><tt class="py-lineno">363</tt>  <tt class="py-line">                        <tt class="py-name">training_parameters_copy</tt><tt class="py-op">[</tt><tt class="py-string">'train_nonlinearity'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">True</tt> </tt>
<a name="L364"></a><tt class="py-lineno">364</tt>  <tt class="py-line">                        <tt class="py-name">model</tt><tt class="py-op">.</tt><tt id="link-2" class="py-name"><a title="c2s.c2s.train" class="py-name" href="#" onclick="return doclink('link-2', 'train', 'link-0');">train</a></tt><tt class="py-op">(</tt><tt class="py-op">*</tt><tt class="py-name">inputs_outputs</tt><tt class="py-op">,</tt> <tt class="py-name">parameters</tt><tt class="py-op">=</tt><tt class="py-name">training_parameters_copy</tt><tt class="py-op">)</tt> </tt>
<a name="L365"></a><tt class="py-lineno">365</tt>  <tt class="py-line"> </tt>
<a name="L366"></a><tt class="py-lineno">366</tt>  <tt class="py-line">                <tt class="py-name">models</tt><tt class="py-op">.</tt><tt class="py-name">append</tt><tt class="py-op">(</tt><tt class="py-name">model</tt><tt class="py-op">)</tt> </tt>
<a name="L367"></a><tt class="py-lineno">367</tt>  <tt class="py-line"> </tt>
<a name="L368"></a><tt class="py-lineno">368</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-keyword">not</tt> <tt class="py-name">keep_all</tt><tt class="py-op">:</tt> </tt>
<a name="L369"></a><tt class="py-lineno">369</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L370"></a><tt class="py-lineno">370</tt>  <tt class="py-line">                        <tt class="py-keyword">print</tt> <tt class="py-string">'Only keep STM with best performance...'</tt> </tt>
<a name="L371"></a><tt class="py-lineno">371</tt>  <tt class="py-line"> </tt>
<a name="L372"></a><tt class="py-lineno">372</tt>  <tt class="py-line">                <tt class="py-name">inputs</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">)</tt> </tt>
<a name="L373"></a><tt class="py-lineno">373</tt>  <tt class="py-line">                <tt class="py-name">outputs</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'outputs'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">)</tt> </tt>
<a name="L374"></a><tt class="py-lineno">374</tt>  <tt class="py-line"> </tt>
<a name="L375"></a><tt class="py-lineno">375</tt>  <tt class="py-line">                <tt class="py-comment"># compute negativ log-likelihoods</tt> </tt>
<a name="L376"></a><tt class="py-lineno">376</tt>  <tt class="py-line">                <tt class="py-name">logloss</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-op">]</tt> </tt>
<a name="L377"></a><tt class="py-lineno">377</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-name">model</tt> <tt class="py-keyword">in</tt> <tt class="py-name">models</tt><tt class="py-op">:</tt> </tt>
<a name="L378"></a><tt class="py-lineno">378</tt>  <tt class="py-line">                        <tt class="py-name">logloss</tt><tt class="py-op">.</tt><tt class="py-name">append</tt><tt class="py-op">(</tt><tt class="py-name">model</tt><tt class="py-op">.</tt><tt id="link-3" class="py-name" targets="Function c2s.c2s.evaluate()=c2s.c2s-module.html#evaluate"><a title="c2s.c2s.evaluate" class="py-name" href="#" onclick="return doclink('link-3', 'evaluate', 'link-3');">evaluate</a></tt><tt class="py-op">(</tt><tt class="py-name">inputs</tt><tt class="py-op">,</tt> <tt class="py-name">outputs</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L379"></a><tt class="py-lineno">379</tt>  <tt class="py-line"> </tt>
<a name="L380"></a><tt class="py-lineno">380</tt>  <tt class="py-line">                <tt class="py-comment"># pick best model</tt> </tt>
<a name="L381"></a><tt class="py-lineno">381</tt>  <tt class="py-line">                <tt class="py-name">models</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-name">models</tt><tt class="py-op">[</tt><tt class="py-name">argmin</tt><tt class="py-op">(</tt><tt class="py-name">logloss</tt><tt class="py-op">)</tt><tt class="py-op">]</tt><tt class="py-op">]</tt> </tt>
<a name="L382"></a><tt class="py-lineno">382</tt>  <tt class="py-line"> </tt>
<a name="L383"></a><tt class="py-lineno">383</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt> <tt class="py-op">{</tt> </tt>
<a name="L384"></a><tt class="py-lineno">384</tt>  <tt class="py-line">                <tt class="py-string">'pca'</tt><tt class="py-op">:</tt> <tt class="py-name">pca</tt><tt class="py-op">,</tt> </tt>
<a name="L385"></a><tt class="py-lineno">385</tt>  <tt class="py-line">                <tt class="py-string">'input_mask'</tt><tt class="py-op">:</tt> <tt class="py-name">input_mask</tt><tt class="py-op">,</tt> </tt>
<a name="L386"></a><tt class="py-lineno">386</tt>  <tt class="py-line">                <tt class="py-string">'output_mask'</tt><tt class="py-op">:</tt> <tt class="py-name">output_mask</tt><tt class="py-op">,</tt> </tt>
<a name="L387"></a><tt class="py-lineno">387</tt>  <tt class="py-line">                <tt class="py-string">'models'</tt><tt class="py-op">:</tt> <tt class="py-name">models</tt><tt class="py-op">}</tt> </tt>
</div><a name="L388"></a><tt class="py-lineno">388</tt>  <tt class="py-line"> </tt>
<a name="L389"></a><tt class="py-lineno">389</tt>  <tt class="py-line"> </tt>
<a name="L390"></a><tt class="py-lineno">390</tt>  <tt class="py-line"> </tt>
<a name="predict"></a><div id="predict-def"><a name="L391"></a><tt class="py-lineno">391</tt> <a class="py-toggle" href="#" id="predict-toggle" onclick="return toggle('predict');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="c2s.c2s-module.html#predict">predict</a><tt class="py-op">(</tt><tt class="py-param">data</tt><tt class="py-op">,</tt> <tt class="py-param">results</tt><tt class="py-op">=</tt><tt class="py-name">None</tt><tt class="py-op">,</tt> <tt class="py-param">max_spikes_per_sec</tt><tt class="py-op">=</tt><tt class="py-number">1000.</tt><tt class="py-op">,</tt> <tt class="py-param">verbosity</tt><tt class="py-op">=</tt><tt class="py-number">1</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="predict-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="predict-expanded"><a name="L392"></a><tt class="py-lineno">392</tt>  <tt class="py-line">        <tt class="py-docstring">"""</tt> </tt>
<a name="L393"></a><tt class="py-lineno">393</tt>  <tt class="py-line"><tt class="py-docstring">        Predicts firing rates from calcium traces using spiking neuron models.</tt> </tt>
<a name="L394"></a><tt class="py-lineno">394</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L395"></a><tt class="py-lineno">395</tt>  <tt class="py-line"><tt class="py-docstring">        If no model is specified via C{results}, a default model is used which was trained</tt> </tt>
<a name="L396"></a><tt class="py-lineno">396</tt>  <tt class="py-line"><tt class="py-docstring">        on two datasets of V1 recordings of mice (dataset 1 and 2 of Theis et al., 2014).</tt> </tt>
<a name="L397"></a><tt class="py-lineno">397</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L398"></a><tt class="py-lineno">398</tt>  <tt class="py-line"><tt class="py-docstring">        @type  data: list</tt> </tt>
<a name="L399"></a><tt class="py-lineno">399</tt>  <tt class="py-line"><tt class="py-docstring">        @param data: list of dictionaries containing calcium/fluorescence traces</tt> </tt>
<a name="L400"></a><tt class="py-lineno">400</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L401"></a><tt class="py-lineno">401</tt>  <tt class="py-line"><tt class="py-docstring">        @type  results: dict/None</tt> </tt>
<a name="L402"></a><tt class="py-lineno">402</tt>  <tt class="py-line"><tt class="py-docstring">        @param results: dictionary containing results of training procedure</tt> </tt>
<a name="L403"></a><tt class="py-lineno">403</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L404"></a><tt class="py-lineno">404</tt>  <tt class="py-line"><tt class="py-docstring">        @type  max_spikes_per_sec: float</tt> </tt>
<a name="L405"></a><tt class="py-lineno">405</tt>  <tt class="py-line"><tt class="py-docstring">        @param max_spikes_per_sec: prevents unreasonable spike count predictions</tt> </tt>
<a name="L406"></a><tt class="py-lineno">406</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L407"></a><tt class="py-lineno">407</tt>  <tt class="py-line"><tt class="py-docstring">        @type  verbosity: int</tt> </tt>
<a name="L408"></a><tt class="py-lineno">408</tt>  <tt class="py-line"><tt class="py-docstring">        @param verbosity: if positive, print messages indicating progress</tt> </tt>
<a name="L409"></a><tt class="py-lineno">409</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L410"></a><tt class="py-lineno">410</tt>  <tt class="py-line"><tt class="py-docstring">        @rtype: list</tt> </tt>
<a name="L411"></a><tt class="py-lineno">411</tt>  <tt class="py-line"><tt class="py-docstring">        @return: returns a list of dictionaries like C{data} but with added predictions</tt> </tt>
<a name="L412"></a><tt class="py-lineno">412</tt>  <tt class="py-line"><tt class="py-docstring">        """</tt> </tt>
<a name="L413"></a><tt class="py-lineno">413</tt>  <tt class="py-line"> </tt>
<a name="L414"></a><tt class="py-lineno">414</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">type</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> <tt class="py-keyword">is</tt> <tt class="py-name">dict</tt><tt class="py-op">:</tt> </tt>
<a name="L415"></a><tt class="py-lineno">415</tt>  <tt class="py-line">                <tt class="py-name">data</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-name">data</tt><tt class="py-op">]</tt> </tt>
<a name="L416"></a><tt class="py-lineno">416</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">type</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> <tt class="py-keyword">is</tt> <tt class="py-keyword">not</tt> <tt class="py-name">list</tt> <tt class="py-keyword">or</tt> <tt class="py-op">(</tt><tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt> <tt class="py-keyword">and</tt> <tt class="py-name">type</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> <tt class="py-keyword">is</tt> <tt class="py-keyword">not</tt> <tt class="py-name">dict</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L417"></a><tt class="py-lineno">417</tt>  <tt class="py-line">                <tt class="py-name">data</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-op">{</tt><tt class="py-string">'calcium'</tt><tt class="py-op">:</tt> <tt class="py-name">data</tt><tt class="py-op">}</tt><tt class="py-op">]</tt> </tt>
<a name="L418"></a><tt class="py-lineno">418</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">results</tt> <tt class="py-keyword">is</tt> <tt class="py-name">None</tt><tt class="py-op">:</tt> </tt>
<a name="L419"></a><tt class="py-lineno">419</tt>  <tt class="py-line">                <tt class="py-name">results</tt> <tt class="py-op">=</tt> <tt class="py-name">loads</tt><tt class="py-op">(</tt><tt class="py-name">b64decode</tt><tt class="py-op">(</tt><tt class="py-name">DEFAULT_MODEL</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L420"></a><tt class="py-lineno">420</tt>  <tt class="py-line"> </tt>
<a name="L421"></a><tt class="py-lineno">421</tt>  <tt class="py-line">        <tt class="py-comment"># create copies of dictionaries (doesn't create copies of actual data arrays)</tt> </tt>
<a name="L422"></a><tt class="py-lineno">422</tt>  <tt class="py-line">        <tt class="py-name">data</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-name">copy</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">)</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">]</tt> </tt>
<a name="L423"></a><tt class="py-lineno">423</tt>  <tt class="py-line"> </tt>
<a name="L424"></a><tt class="py-lineno">424</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">:</tt> </tt>
<a name="L425"></a><tt class="py-lineno">425</tt>  <tt class="py-line">                <tt class="py-comment"># extract windows from fluorescence trace and reduce dimensionality</tt> </tt>
<a name="L426"></a><tt class="py-lineno">426</tt>  <tt class="py-line">                <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">extract_windows</tt><tt class="py-op">(</tt> </tt>
<a name="L427"></a><tt class="py-lineno">427</tt>  <tt class="py-line">                        <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">sum</tt><tt class="py-op">(</tt><tt class="py-name">results</tt><tt class="py-op">[</tt><tt class="py-string">'input_mask'</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L428"></a><tt class="py-lineno">428</tt>  <tt class="py-line">                <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">results</tt><tt class="py-op">[</tt><tt class="py-string">'pca'</tt><tt class="py-op">]</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L429"></a><tt class="py-lineno">429</tt>  <tt class="py-line"> </tt>
<a name="L430"></a><tt class="py-lineno">430</tt>  <tt class="py-line">        <tt class="py-name">pad_left</tt>  <tt class="py-op">=</tt> <tt class="py-name">int</tt><tt class="py-op">(</tt><tt class="py-name">where</tt><tt class="py-op">(</tt><tt class="py-name">results</tt><tt class="py-op">[</tt><tt class="py-string">'output_mask'</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt> <tt class="py-op">+</tt> <tt class="py-number">.5</tt><tt class="py-op">)</tt> </tt>
<a name="L431"></a><tt class="py-lineno">431</tt>  <tt class="py-line">        <tt class="py-name">pad_right</tt> <tt class="py-op">=</tt> <tt class="py-name">results</tt><tt class="py-op">[</tt><tt class="py-string">'output_mask'</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">shape</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">]</tt> <tt class="py-op">-</tt> <tt class="py-name">pad_left</tt> <tt class="py-op">-</tt> <tt class="py-number">1</tt> </tt>
<a name="L432"></a><tt class="py-lineno">432</tt>  <tt class="py-line"> </tt>
<a name="L433"></a><tt class="py-lineno">433</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">k</tt><tt class="py-op">,</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">enumerate</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L434"></a><tt class="py-lineno">434</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L435"></a><tt class="py-lineno">435</tt>  <tt class="py-line">                        <tt class="py-keyword">print</tt> <tt class="py-string">'Predicting cell {0}...'</tt><tt class="py-op">.</tt><tt class="py-name">format</tt><tt class="py-op">(</tt><tt class="py-name">k</tt><tt class="py-op">)</tt> </tt>
<a name="L436"></a><tt class="py-lineno">436</tt>  <tt class="py-line"> </tt>
<a name="L437"></a><tt class="py-lineno">437</tt>  <tt class="py-line">                <tt class="py-name">max_spikes</tt> <tt class="py-op">=</tt> <tt class="py-name">max_spikes_per_sec</tt> <tt class="py-op">/</tt> <tt class="py-name">float</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L438"></a><tt class="py-lineno">438</tt>  <tt class="py-line"> </tt>
<a name="L439"></a><tt class="py-lineno">439</tt>  <tt class="py-line">                <tt class="py-name">predictions</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-op">]</tt> </tt>
<a name="L440"></a><tt class="py-lineno">440</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-name">model</tt> <tt class="py-keyword">in</tt> <tt class="py-name">results</tt><tt class="py-op">[</tt><tt class="py-string">'models'</tt><tt class="py-op">]</tt><tt class="py-op">:</tt> </tt>
<a name="L441"></a><tt class="py-lineno">441</tt>  <tt class="py-line">                        <tt class="py-comment"># compute conditional expectation</tt> </tt>
<a name="L442"></a><tt class="py-lineno">442</tt>  <tt class="py-line">                        <tt class="py-name">pred</tt> <tt class="py-op">=</tt> <tt class="py-name">model</tt><tt class="py-op">.</tt><tt id="link-4" class="py-name" targets="Function c2s.c2s.predict()=c2s.c2s-module.html#predict"><a title="c2s.c2s.predict" class="py-name" href="#" onclick="return doclink('link-4', 'predict', 'link-4');">predict</a></tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">ravel</tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L443"></a><tt class="py-lineno">443</tt>  <tt class="py-line">                        <tt class="py-name">pred</tt><tt class="py-op">[</tt><tt class="py-name">pred</tt> <tt class="py-op">&gt;</tt> <tt class="py-name">max_spikes</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">max_spikes</tt> </tt>
<a name="L444"></a><tt class="py-lineno">444</tt>  <tt class="py-line">                        <tt class="py-name">predictions</tt><tt class="py-op">.</tt><tt class="py-name">append</tt><tt class="py-op">(</tt><tt class="py-name">pred</tt><tt class="py-op">)</tt> </tt>
<a name="L445"></a><tt class="py-lineno">445</tt>  <tt class="py-line"> </tt>
<a name="L446"></a><tt class="py-lineno">446</tt>  <tt class="py-line">                <tt class="py-comment"># average predicted firing rate</tt> </tt>
<a name="L447"></a><tt class="py-lineno">447</tt>  <tt class="py-line">                <tt class="py-name">avg</tt> <tt class="py-op">=</tt> <tt class="py-name">mean</tt><tt class="py-op">(</tt><tt class="py-name">asarray</tt><tt class="py-op">(</tt><tt class="py-name">gmean</tt><tt class="py-op">(</tt><tt class="py-name">predictions</tt><tt class="py-op">,</tt> <tt class="py-number">0</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L448"></a><tt class="py-lineno">448</tt>  <tt class="py-line"> </tt>
<a name="L449"></a><tt class="py-lineno">449</tt>  <tt class="py-line">                <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'predictions'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-op">[</tt> </tt>
<a name="L450"></a><tt class="py-lineno">450</tt>  <tt class="py-line">                        <tt class="py-name">zeros</tt><tt class="py-op">(</tt><tt class="py-name">pad_left</tt><tt class="py-op">)</tt> <tt class="py-op">+</tt> <tt class="py-name">avg</tt><tt class="py-op">,</tt> </tt>
<a name="L451"></a><tt class="py-lineno">451</tt>  <tt class="py-line">                        <tt class="py-name">asarray</tt><tt class="py-op">(</tt><tt class="py-name">gmean</tt><tt class="py-op">(</tt><tt class="py-name">predictions</tt><tt class="py-op">,</tt> <tt class="py-number">0</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L452"></a><tt class="py-lineno">452</tt>  <tt class="py-line">                        <tt class="py-name">zeros</tt><tt class="py-op">(</tt><tt class="py-name">pad_right</tt><tt class="py-op">)</tt> <tt class="py-op">+</tt> <tt class="py-name">avg</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">reshape</tt><tt class="py-op">(</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">)</tt> </tt>
<a name="L453"></a><tt class="py-lineno">453</tt>  <tt class="py-line"> </tt>
<a name="L454"></a><tt class="py-lineno">454</tt>  <tt class="py-line">                <tt class="py-comment"># inputs no longer needed</tt> </tt>
<a name="L455"></a><tt class="py-lineno">455</tt>  <tt class="py-line">                <tt class="py-keyword">del</tt> <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> </tt>
<a name="L456"></a><tt class="py-lineno">456</tt>  <tt class="py-line"> </tt>
<a name="L457"></a><tt class="py-lineno">457</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt> <tt class="py-name">data</tt> </tt>
</div><a name="L458"></a><tt class="py-lineno">458</tt>  <tt class="py-line"> </tt>
<a name="L459"></a><tt class="py-lineno">459</tt>  <tt class="py-line"> </tt>
<a name="L460"></a><tt class="py-lineno">460</tt>  <tt class="py-line"> </tt>
<a name="evaluate"></a><div id="evaluate-def"><a name="L461"></a><tt class="py-lineno">461</tt> <a class="py-toggle" href="#" id="evaluate-toggle" onclick="return toggle('evaluate');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="c2s.c2s-module.html#evaluate">evaluate</a><tt class="py-op">(</tt><tt class="py-param">data</tt><tt class="py-op">,</tt> <tt class="py-param">method</tt><tt class="py-op">=</tt><tt class="py-string">'corr'</tt><tt class="py-op">,</tt> <tt class="py-op">**</tt><tt class="py-param">kwargs</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="evaluate-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="evaluate-expanded"><a name="L462"></a><tt class="py-lineno">462</tt>  <tt class="py-line">        <tt class="py-docstring">"""</tt> </tt>
<a name="L463"></a><tt class="py-lineno">463</tt>  <tt class="py-line"><tt class="py-docstring">        Evaluates predictions using either Pearson's correlation, log-likelihood, information rates,</tt> </tt>
<a name="L464"></a><tt class="py-lineno">464</tt>  <tt class="py-line"><tt class="py-docstring">        or area under the ROC curve.</tt> </tt>
<a name="L465"></a><tt class="py-lineno">465</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L466"></a><tt class="py-lineno">466</tt>  <tt class="py-line"><tt class="py-docstring">        @type  data: list</tt> </tt>
<a name="L467"></a><tt class="py-lineno">467</tt>  <tt class="py-line"><tt class="py-docstring">        @param data: list of dictionaries as produced by L{predict&lt;c2s.predict&gt;}</tt> </tt>
<a name="L468"></a><tt class="py-lineno">468</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L469"></a><tt class="py-lineno">469</tt>  <tt class="py-line"><tt class="py-docstring">        @type  method: string</tt> </tt>
<a name="L470"></a><tt class="py-lineno">470</tt>  <tt class="py-line"><tt class="py-docstring">        @param method: either 'loglik', 'info', 'corr', or 'auc' (default: 'corr')</tt> </tt>
<a name="L471"></a><tt class="py-lineno">471</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L472"></a><tt class="py-lineno">472</tt>  <tt class="py-line"><tt class="py-docstring">        @type  downsampling: int</tt> </tt>
<a name="L473"></a><tt class="py-lineno">473</tt>  <tt class="py-line"><tt class="py-docstring">        @param downsampling: downsample spike trains and predictions by this factor before evaluation (default: 1)</tt> </tt>
<a name="L474"></a><tt class="py-lineno">474</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L475"></a><tt class="py-lineno">475</tt>  <tt class="py-line"><tt class="py-docstring">        @type  optimize: bool</tt> </tt>
<a name="L476"></a><tt class="py-lineno">476</tt>  <tt class="py-line"><tt class="py-docstring">        @param optimize: find optimal point-wise monotonic nonlinearity before evaluation of log-likelihood (default: True)</tt> </tt>
<a name="L477"></a><tt class="py-lineno">477</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L478"></a><tt class="py-lineno">478</tt>  <tt class="py-line"><tt class="py-docstring">        @type  regularize: int</tt> </tt>
<a name="L479"></a><tt class="py-lineno">479</tt>  <tt class="py-line"><tt class="py-docstring">        @param regularize: regularize point-wise monotonic nonlinearity to be smooth (default: 5e-3)</tt> </tt>
<a name="L480"></a><tt class="py-lineno">480</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L481"></a><tt class="py-lineno">481</tt>  <tt class="py-line"><tt class="py-docstring">        @type  verbosity: int</tt> </tt>
<a name="L482"></a><tt class="py-lineno">482</tt>  <tt class="py-line"><tt class="py-docstring">        @param verbosity: controls output during optimization of nonlinearity (default: 2)</tt> </tt>
<a name="L483"></a><tt class="py-lineno">483</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L484"></a><tt class="py-lineno">484</tt>  <tt class="py-line"><tt class="py-docstring">        @type  return_all: bool</tt> </tt>
<a name="L485"></a><tt class="py-lineno">485</tt>  <tt class="py-line"><tt class="py-docstring">        @param return_all: if true, return additional information and not just performance (default: False)</tt> </tt>
<a name="L486"></a><tt class="py-lineno">486</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L487"></a><tt class="py-lineno">487</tt>  <tt class="py-line"><tt class="py-docstring">        @rtype: ndarray</tt> </tt>
<a name="L488"></a><tt class="py-lineno">488</tt>  <tt class="py-line"><tt class="py-docstring">        @return: a value for each cell</tt> </tt>
<a name="L489"></a><tt class="py-lineno">489</tt>  <tt class="py-line"><tt class="py-docstring">        """</tt> </tt>
<a name="L490"></a><tt class="py-lineno">490</tt>  <tt class="py-line"> </tt>
<a name="L491"></a><tt class="py-lineno">491</tt>  <tt class="py-line">        <tt class="py-name">kwargs</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'downsampling'</tt><tt class="py-op">,</tt> <tt class="py-number">1</tt><tt class="py-op">)</tt> </tt>
<a name="L492"></a><tt class="py-lineno">492</tt>  <tt class="py-line">        <tt class="py-name">kwargs</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'num_support'</tt><tt class="py-op">,</tt> <tt class="py-number">10</tt><tt class="py-op">)</tt> </tt>
<a name="L493"></a><tt class="py-lineno">493</tt>  <tt class="py-line">        <tt class="py-name">kwargs</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'regularize'</tt><tt class="py-op">,</tt> <tt class="py-number">5e-8</tt><tt class="py-op">)</tt> </tt>
<a name="L494"></a><tt class="py-lineno">494</tt>  <tt class="py-line">        <tt class="py-name">kwargs</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'optimize'</tt><tt class="py-op">,</tt> <tt class="py-name">True</tt><tt class="py-op">)</tt> </tt>
<a name="L495"></a><tt class="py-lineno">495</tt>  <tt class="py-line">        <tt class="py-name">kwargs</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'return_all'</tt><tt class="py-op">,</tt> <tt class="py-name">False</tt><tt class="py-op">)</tt> </tt>
<a name="L496"></a><tt class="py-lineno">496</tt>  <tt class="py-line">        <tt class="py-name">kwargs</tt><tt class="py-op">.</tt><tt class="py-name">setdefault</tt><tt class="py-op">(</tt><tt class="py-string">'verbosity'</tt><tt class="py-op">,</tt> <tt class="py-number">2</tt><tt class="py-op">)</tt> </tt>
<a name="L497"></a><tt class="py-lineno">497</tt>  <tt class="py-line"> </tt>
<a name="L498"></a><tt class="py-lineno">498</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-string">'downsample'</tt> <tt class="py-keyword">in</tt> <tt class="py-name">kwargs</tt><tt class="py-op">:</tt> </tt>
<a name="L499"></a><tt class="py-lineno">499</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt> <tt class="py-string">'Did you mean `downsampling`?'</tt> </tt>
<a name="L500"></a><tt class="py-lineno">500</tt>  <tt class="py-line">                <tt class="py-keyword">return</tt> </tt>
<a name="L501"></a><tt class="py-lineno">501</tt>  <tt class="py-line"> </tt>
<a name="L502"></a><tt class="py-lineno">502</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-string">'regularization'</tt> <tt class="py-keyword">in</tt> <tt class="py-name">kwargs</tt><tt class="py-op">:</tt> </tt>
<a name="L503"></a><tt class="py-lineno">503</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt> <tt class="py-string">'Did you mean `regularize`?'</tt> </tt>
<a name="L504"></a><tt class="py-lineno">504</tt>  <tt class="py-line">                <tt class="py-keyword">return</tt> </tt>
<a name="L505"></a><tt class="py-lineno">505</tt>  <tt class="py-line"> </tt>
<a name="L506"></a><tt class="py-lineno">506</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">method</tt><tt class="py-op">.</tt><tt class="py-name">lower</tt><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">startswith</tt><tt class="py-op">(</tt><tt class="py-string">'c'</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L507"></a><tt class="py-lineno">507</tt>  <tt class="py-line">                <tt class="py-name">corr</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-op">]</tt> </tt>
<a name="L508"></a><tt class="py-lineno">508</tt>  <tt class="py-line"> </tt>
<a name="L509"></a><tt class="py-lineno">509</tt>  <tt class="py-line">                <tt class="py-comment"># compute correlations</tt> </tt>
<a name="L510"></a><tt class="py-lineno">510</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">:</tt> </tt>
<a name="L511"></a><tt class="py-lineno">511</tt>  <tt class="py-line">                        <tt class="py-name">corr</tt><tt class="py-op">.</tt><tt class="py-name">append</tt><tt class="py-op">(</tt> </tt>
<a name="L512"></a><tt class="py-lineno">512</tt>  <tt class="py-line">                                <tt class="py-name">corrcoef</tt><tt class="py-op">(</tt> </tt>
<a name="L513"></a><tt class="py-lineno">513</tt>  <tt class="py-line">                                        <tt class="py-name">downsample</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'predictions'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'downsampling'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L514"></a><tt class="py-lineno">514</tt>  <tt class="py-line">                                        <tt class="py-name">downsample</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'spikes'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'downsampling'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">,</tt> <tt class="py-number">1</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L515"></a><tt class="py-lineno">515</tt>  <tt class="py-line"> </tt>
<a name="L516"></a><tt class="py-lineno">516</tt>  <tt class="py-line">                <tt class="py-keyword">return</tt> <tt class="py-name">array</tt><tt class="py-op">(</tt><tt class="py-name">corr</tt><tt class="py-op">)</tt> </tt>
<a name="L517"></a><tt class="py-lineno">517</tt>  <tt class="py-line"> </tt>
<a name="L518"></a><tt class="py-lineno">518</tt>  <tt class="py-line">        <tt class="py-keyword">elif</tt> <tt class="py-name">method</tt><tt class="py-op">.</tt><tt class="py-name">lower</tt><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">startswith</tt><tt class="py-op">(</tt><tt class="py-string">'a'</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L519"></a><tt class="py-lineno">519</tt>  <tt class="py-line">                <tt class="py-name">auc</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-op">]</tt> </tt>
<a name="L520"></a><tt class="py-lineno">520</tt>  <tt class="py-line"> </tt>
<a name="L521"></a><tt class="py-lineno">521</tt>  <tt class="py-line">                <tt class="py-comment"># compute area under ROC curve</tt> </tt>
<a name="L522"></a><tt class="py-lineno">522</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">:</tt> </tt>
<a name="L523"></a><tt class="py-lineno">523</tt>  <tt class="py-line">                        <tt class="py-comment"># downsample firing rates</tt> </tt>
<a name="L524"></a><tt class="py-lineno">524</tt>  <tt class="py-line">                        <tt class="py-name">predictions</tt> <tt class="py-op">=</tt> <tt class="py-name">downsample</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'predictions'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'downsampling'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">ravel</tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L525"></a><tt class="py-lineno">525</tt>  <tt class="py-line">                        <tt class="py-name">spikes</tt> <tt class="py-op">=</tt> <tt class="py-name">array</tt><tt class="py-op">(</tt><tt class="py-name">downsample</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'spikes'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'downsampling'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">ravel</tt><tt class="py-op">(</tt><tt class="py-op">)</tt> <tt class="py-op">+</tt> <tt class="py-number">.5</tt><tt class="py-op">,</tt> <tt class="py-name">dtype</tt><tt class="py-op">=</tt><tt class="py-name">int</tt><tt class="py-op">)</tt> </tt>
<a name="L526"></a><tt class="py-lineno">526</tt>  <tt class="py-line"> </tt>
<a name="L527"></a><tt class="py-lineno">527</tt>  <tt class="py-line">                        <tt class="py-comment"># marks bins containing spikes</tt> </tt>
<a name="L528"></a><tt class="py-lineno">528</tt>  <tt class="py-line">                        <tt class="py-name">mask</tt> <tt class="py-op">=</tt> <tt class="py-name">spikes</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">.5</tt> </tt>
<a name="L529"></a><tt class="py-lineno">529</tt>  <tt class="py-line"> </tt>
<a name="L530"></a><tt class="py-lineno">530</tt>  <tt class="py-line">                        <tt class="py-comment"># collect positive and negative examples</tt> </tt>
<a name="L531"></a><tt class="py-lineno">531</tt>  <tt class="py-line">                        <tt class="py-name">neg</tt> <tt class="py-op">=</tt> <tt class="py-name">predictions</tt><tt class="py-op">[</tt><tt class="py-op">-</tt><tt class="py-name">mask</tt><tt class="py-op">]</tt> </tt>
<a name="L532"></a><tt class="py-lineno">532</tt>  <tt class="py-line">                        <tt class="py-name">pos</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-op">]</tt> </tt>
<a name="L533"></a><tt class="py-lineno">533</tt>  <tt class="py-line"> </tt>
<a name="L534"></a><tt class="py-lineno">534</tt>  <tt class="py-line">                        <tt class="py-comment"># this loop is necessary because any bin can contain more than one spike</tt> </tt>
<a name="L535"></a><tt class="py-lineno">535</tt>  <tt class="py-line">                        <tt class="py-keyword">while</tt> <tt class="py-name">any</tt><tt class="py-op">(</tt><tt class="py-name">mask</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L536"></a><tt class="py-lineno">536</tt>  <tt class="py-line">                                <tt class="py-name">pos</tt><tt class="py-op">.</tt><tt class="py-name">append</tt><tt class="py-op">(</tt><tt class="py-name">predictions</tt><tt class="py-op">[</tt><tt class="py-name">mask</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L537"></a><tt class="py-lineno">537</tt>  <tt class="py-line">                                <tt class="py-name">spikes</tt> <tt class="py-op">-=</tt> <tt class="py-number">1</tt> </tt>
<a name="L538"></a><tt class="py-lineno">538</tt>  <tt class="py-line">                                <tt class="py-name">mask</tt> <tt class="py-op">=</tt> <tt class="py-name">spikes</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">.5</tt> </tt>
<a name="L539"></a><tt class="py-lineno">539</tt>  <tt class="py-line">                        <tt class="py-name">pos</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">pos</tt><tt class="py-op">)</tt> </tt>
<a name="L540"></a><tt class="py-lineno">540</tt>  <tt class="py-line"> </tt>
<a name="L541"></a><tt class="py-lineno">541</tt>  <tt class="py-line">                        <tt class="py-comment"># compute area under curve</tt> </tt>
<a name="L542"></a><tt class="py-lineno">542</tt>  <tt class="py-line">                        <tt class="py-name">auc</tt><tt class="py-op">.</tt><tt class="py-name">append</tt><tt class="py-op">(</tt><tt class="py-name">roc</tt><tt class="py-op">(</tt><tt class="py-name">pos</tt><tt class="py-op">,</tt> <tt class="py-name">neg</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L543"></a><tt class="py-lineno">543</tt>  <tt class="py-line"> </tt>
<a name="L544"></a><tt class="py-lineno">544</tt>  <tt class="py-line">                <tt class="py-keyword">return</tt> <tt class="py-name">array</tt><tt class="py-op">(</tt><tt class="py-name">auc</tt><tt class="py-op">)</tt> </tt>
<a name="L545"></a><tt class="py-lineno">545</tt>  <tt class="py-line"> </tt>
<a name="L546"></a><tt class="py-lineno">546</tt>  <tt class="py-line">        <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L547"></a><tt class="py-lineno">547</tt>  <tt class="py-line">                <tt class="py-comment"># downsample predictions and spike trains</tt> </tt>
<a name="L548"></a><tt class="py-lineno">548</tt>  <tt class="py-line">                <tt class="py-name">spikes</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-name">downsample</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'spikes'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'downsampling'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">]</tt> </tt>
<a name="L549"></a><tt class="py-lineno">549</tt>  <tt class="py-line">                <tt class="py-name">predictions</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-name">downsample</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'predictions'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'downsampling'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">]</tt> </tt>
<a name="L550"></a><tt class="py-lineno">550</tt>  <tt class="py-line"> </tt>
<a name="L551"></a><tt class="py-lineno">551</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'optimize'</tt><tt class="py-op">]</tt><tt class="py-op">:</tt> </tt>
<a name="L552"></a><tt class="py-lineno">552</tt>  <tt class="py-line">                        <tt class="py-comment"># find optimal point-wise monotonic function</tt> </tt>
<a name="L553"></a><tt class="py-lineno">553</tt>  <tt class="py-line">                        <tt class="py-name">f</tt> <tt class="py-op">=</tt> <tt class="py-name">optimize_predictions</tt><tt class="py-op">(</tt> </tt>
<a name="L554"></a><tt class="py-lineno">554</tt>  <tt class="py-line">                                <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">predictions</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L555"></a><tt class="py-lineno">555</tt>  <tt class="py-line">                                <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">spikes</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L556"></a><tt class="py-lineno">556</tt>  <tt class="py-line">                                <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'num_support'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> </tt>
<a name="L557"></a><tt class="py-lineno">557</tt>  <tt class="py-line">                                <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'regularize'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> </tt>
<a name="L558"></a><tt class="py-lineno">558</tt>  <tt class="py-line">                                <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'verbosity'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L559"></a><tt class="py-lineno">559</tt>  <tt class="py-line">                <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L560"></a><tt class="py-lineno">560</tt>  <tt class="py-line">                        <tt class="py-name">f</tt> <tt class="py-op">=</tt> <tt class="py-keyword">lambda</tt> <tt class="py-name">x</tt><tt class="py-op">:</tt> <tt class="py-name">x</tt> </tt>
<a name="L561"></a><tt class="py-lineno">561</tt>  <tt class="py-line"> </tt>
<a name="L562"></a><tt class="py-lineno">562</tt>  <tt class="py-line">                <tt class="py-comment"># for conversion into bit/s</tt> </tt>
<a name="L563"></a><tt class="py-lineno">563</tt>  <tt class="py-line">                <tt class="py-name">factor</tt> <tt class="py-op">=</tt> <tt class="py-number">1.</tt> <tt class="py-op">/</tt> <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'downsampling'</tt><tt class="py-op">]</tt> <tt class="py-op">/</tt> <tt class="py-name">log</tt><tt class="py-op">(</tt><tt class="py-number">2.</tt><tt class="py-op">)</tt> </tt>
<a name="L564"></a><tt class="py-lineno">564</tt>  <tt class="py-line"> </tt>
<a name="L565"></a><tt class="py-lineno">565</tt>  <tt class="py-line">                <tt class="py-comment"># average firing rate (Hz) over all cells</tt> </tt>
<a name="L566"></a><tt class="py-lineno">566</tt>  <tt class="py-line">                <tt class="py-name">firing_rate</tt> <tt class="py-op">=</tt> <tt class="py-name">mean</tt><tt class="py-op">(</tt><tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-name">s</tt> <tt class="py-op">*</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">k</tt><tt class="py-op">,</tt> <tt class="py-name">s</tt> <tt class="py-keyword">in</tt> <tt class="py-name">enumerate</tt><tt class="py-op">(</tt><tt class="py-name">spikes</tt><tt class="py-op">)</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L567"></a><tt class="py-lineno">567</tt>  <tt class="py-line"> </tt>
<a name="L568"></a><tt class="py-lineno">568</tt>  <tt class="py-line">                <tt class="py-comment"># estimate log-likelihood and marginal entropies</tt> </tt>
<a name="L569"></a><tt class="py-lineno">569</tt>  <tt class="py-line">                <tt class="py-name">loglik</tt><tt class="py-op">,</tt> <tt class="py-name">entropy</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-op">[</tt><tt class="py-op">]</tt> </tt>
<a name="L570"></a><tt class="py-lineno">570</tt>  <tt class="py-line">                <tt class="py-keyword">for</tt> <tt class="py-name">k</tt> <tt class="py-keyword">in</tt> <tt class="py-name">range</tt><tt class="py-op">(</tt><tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L571"></a><tt class="py-lineno">571</tt>  <tt class="py-line">                        <tt class="py-name">loglik</tt><tt class="py-op">.</tt><tt class="py-name">append</tt><tt class="py-op">(</tt><tt class="py-name">mean</tt><tt class="py-op">(</tt><tt class="py-name">poisson</tt><tt class="py-op">.</tt><tt class="py-name">logpmf</tt><tt class="py-op">(</tt><tt class="py-name">spikes</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">f</tt><tt class="py-op">(</tt><tt class="py-name">predictions</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-op">*</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt> <tt class="py-op">*</tt> <tt class="py-name">factor</tt><tt class="py-op">)</tt> </tt>
<a name="L572"></a><tt class="py-lineno">572</tt>  <tt class="py-line">                        <tt class="py-name">entropy</tt><tt class="py-op">.</tt><tt class="py-name">append</tt><tt class="py-op">(</tt><tt class="py-op">-</tt><tt class="py-name">mean</tt><tt class="py-op">(</tt><tt class="py-name">poisson</tt><tt class="py-op">.</tt><tt class="py-name">logpmf</tt><tt class="py-op">(</tt><tt class="py-name">spikes</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">firing_rate</tt> <tt class="py-op">/</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-op">*</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-name">k</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt> <tt class="py-op">*</tt> <tt class="py-name">factor</tt><tt class="py-op">)</tt> </tt>
<a name="L573"></a><tt class="py-lineno">573</tt>  <tt class="py-line"> </tt>
<a name="L574"></a><tt class="py-lineno">574</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">method</tt><tt class="py-op">.</tt><tt class="py-name">lower</tt><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">startswith</tt><tt class="py-op">(</tt><tt class="py-string">'l'</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L575"></a><tt class="py-lineno">575</tt>  <tt class="py-line">                        <tt class="py-keyword">if</tt> <tt class="py-name">kwargs</tt><tt class="py-op">[</tt><tt class="py-string">'return_all'</tt><tt class="py-op">]</tt><tt class="py-op">:</tt> </tt>
<a name="L576"></a><tt class="py-lineno">576</tt>  <tt class="py-line">                                <tt class="py-keyword">return</tt> <tt class="py-name">array</tt><tt class="py-op">(</tt><tt class="py-name">loglik</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">array</tt><tt class="py-op">(</tt><tt class="py-name">entropy</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">f</tt> </tt>
<a name="L577"></a><tt class="py-lineno">577</tt>  <tt class="py-line">                        <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L578"></a><tt class="py-lineno">578</tt>  <tt class="py-line">                                <tt class="py-comment"># return log-likelihood</tt> </tt>
<a name="L579"></a><tt class="py-lineno">579</tt>  <tt class="py-line">                                <tt class="py-keyword">return</tt> <tt class="py-name">array</tt><tt class="py-op">(</tt><tt class="py-name">loglik</tt><tt class="py-op">)</tt> </tt>
<a name="L580"></a><tt class="py-lineno">580</tt>  <tt class="py-line">                <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L581"></a><tt class="py-lineno">581</tt>  <tt class="py-line">                        <tt class="py-comment"># return information rates</tt> </tt>
<a name="L582"></a><tt class="py-lineno">582</tt>  <tt class="py-line">                        <tt class="py-keyword">return</tt> <tt class="py-name">array</tt><tt class="py-op">(</tt><tt class="py-name">loglik</tt><tt class="py-op">)</tt> <tt class="py-op">+</tt> <tt class="py-name">array</tt><tt class="py-op">(</tt><tt class="py-name">entropy</tt><tt class="py-op">)</tt> </tt>
</div><a name="L583"></a><tt class="py-lineno">583</tt>  <tt class="py-line"> </tt>
<a name="L584"></a><tt class="py-lineno">584</tt>  <tt class="py-line"> </tt>
<a name="L585"></a><tt class="py-lineno">585</tt>  <tt class="py-line"> </tt>
<a name="optimize_predictions"></a><div id="optimize_predictions-def"><a name="L586"></a><tt class="py-lineno">586</tt> <a class="py-toggle" href="#" id="optimize_predictions-toggle" onclick="return toggle('optimize_predictions');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="c2s.c2s-module.html#optimize_predictions">optimize_predictions</a><tt class="py-op">(</tt><tt class="py-param">predictions</tt><tt class="py-op">,</tt> <tt class="py-param">spikes</tt><tt class="py-op">,</tt> <tt class="py-param">num_support</tt><tt class="py-op">=</tt><tt class="py-number">10</tt><tt class="py-op">,</tt> <tt class="py-param">regularize</tt><tt class="py-op">=</tt><tt class="py-number">5e-8</tt><tt class="py-op">,</tt> <tt class="py-param">verbosity</tt><tt class="py-op">=</tt><tt class="py-number">1</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="optimize_predictions-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="optimize_predictions-expanded"><a name="L587"></a><tt class="py-lineno">587</tt>  <tt class="py-line">        <tt class="py-docstring">"""</tt> </tt>
<a name="L588"></a><tt class="py-lineno">588</tt>  <tt class="py-line"><tt class="py-docstring">        Fits a monotonic piecewise linear function to maximize the Poisson likelihood of</tt> </tt>
<a name="L589"></a><tt class="py-lineno">589</tt>  <tt class="py-line"><tt class="py-docstring">        firing rate predictions interpreted as Poisson rate parameter.</tt> </tt>
<a name="L590"></a><tt class="py-lineno">590</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L591"></a><tt class="py-lineno">591</tt>  <tt class="py-line"><tt class="py-docstring">        @type  predictions: array_like</tt> </tt>
<a name="L592"></a><tt class="py-lineno">592</tt>  <tt class="py-line"><tt class="py-docstring">        @param predictions: predicted firing rates</tt> </tt>
<a name="L593"></a><tt class="py-lineno">593</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L594"></a><tt class="py-lineno">594</tt>  <tt class="py-line"><tt class="py-docstring">        @type  spikes: array_like</tt> </tt>
<a name="L595"></a><tt class="py-lineno">595</tt>  <tt class="py-line"><tt class="py-docstring">        @param spikes: true spike counts</tt> </tt>
<a name="L596"></a><tt class="py-lineno">596</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L597"></a><tt class="py-lineno">597</tt>  <tt class="py-line"><tt class="py-docstring">        @type  num_support: int</tt> </tt>
<a name="L598"></a><tt class="py-lineno">598</tt>  <tt class="py-line"><tt class="py-docstring">        @param num_support: number of support points of the piecewise linear function</tt> </tt>
<a name="L599"></a><tt class="py-lineno">599</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L600"></a><tt class="py-lineno">600</tt>  <tt class="py-line"><tt class="py-docstring">        @type  regularize: float</tt> </tt>
<a name="L601"></a><tt class="py-lineno">601</tt>  <tt class="py-line"><tt class="py-docstring">        @param regularize: strength of regularization for smoothness</tt> </tt>
<a name="L602"></a><tt class="py-lineno">602</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L603"></a><tt class="py-lineno">603</tt>  <tt class="py-line"><tt class="py-docstring">        @rtype: interp1d</tt> </tt>
<a name="L604"></a><tt class="py-lineno">604</tt>  <tt class="py-line"><tt class="py-docstring">        @return: a piecewise monotonic function</tt> </tt>
<a name="L605"></a><tt class="py-lineno">605</tt>  <tt class="py-line"><tt class="py-docstring">        """</tt> </tt>
<a name="L606"></a><tt class="py-lineno">606</tt>  <tt class="py-line"> </tt>
<a name="L607"></a><tt class="py-lineno">607</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">num_support</tt> <tt class="py-op">&lt;</tt> <tt class="py-number">2</tt><tt class="py-op">:</tt> </tt>
<a name="L608"></a><tt class="py-lineno">608</tt>  <tt class="py-line">                <tt class="py-keyword">raise</tt> <tt class="py-name">ValueError</tt><tt class="py-op">(</tt><tt class="py-string">'`num_support` should be at least 2.'</tt><tt class="py-op">)</tt> </tt>
<a name="L609"></a><tt class="py-lineno">609</tt>  <tt class="py-line"> </tt>
<a name="L610"></a><tt class="py-lineno">610</tt>  <tt class="py-line">        <tt class="py-comment"># support points of piece-wise linear function</tt> </tt>
<a name="L611"></a><tt class="py-lineno">611</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">num_support</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">2</tt><tt class="py-op">:</tt> </tt>
<a name="L612"></a><tt class="py-lineno">612</tt>  <tt class="py-line">                <tt class="py-name">F</tt> <tt class="py-op">=</tt> <tt class="py-name">predictions</tt> </tt>
<a name="L613"></a><tt class="py-lineno">613</tt>  <tt class="py-line">                <tt class="py-name">F</tt> <tt class="py-op">=</tt> <tt class="py-name">F</tt><tt class="py-op">[</tt><tt class="py-name">F</tt> <tt class="py-op">&gt;</tt> <tt class="py-op">(</tt><tt class="py-name">max</tt><tt class="py-op">(</tt><tt class="py-name">F</tt><tt class="py-op">)</tt> <tt class="py-op">-</tt> <tt class="py-name">min</tt><tt class="py-op">(</tt><tt class="py-name">F</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-op">/</tt> <tt class="py-number">100.</tt><tt class="py-op">]</tt> </tt>
<a name="L614"></a><tt class="py-lineno">614</tt>  <tt class="py-line">                <tt class="py-name">x</tt> <tt class="py-op">=</tt> <tt class="py-name">list</tt><tt class="py-op">(</tt><tt class="py-name">percentile</tt><tt class="py-op">(</tt><tt class="py-name">F</tt><tt class="py-op">,</tt> <tt class="py-name">range</tt><tt class="py-op">(</tt><tt class="py-number">0</tt><tt class="py-op">,</tt> <tt class="py-number">101</tt><tt class="py-op">,</tt> <tt class="py-name">num_support</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">:</tt><tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L615"></a><tt class="py-lineno">615</tt>  <tt class="py-line">                <tt class="py-name">x</tt> <tt class="py-op">=</tt> <tt class="py-name">asarray</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt> <tt class="py-op">+</tt> <tt class="py-name">x</tt> <tt class="py-op">+</tt> <tt class="py-op">[</tt><tt class="py-name">max</tt><tt class="py-op">(</tt><tt class="py-name">F</tt><tt class="py-op">)</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L616"></a><tt class="py-lineno">616</tt>  <tt class="py-line">        <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L617"></a><tt class="py-lineno">617</tt>  <tt class="py-line">                <tt class="py-name">x</tt> <tt class="py-op">=</tt> <tt class="py-name">asarray</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-name">min</tt><tt class="py-op">(</tt><tt class="py-name">predictions</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">max</tt><tt class="py-op">(</tt><tt class="py-name">predictions</tt><tt class="py-op">)</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L618"></a><tt class="py-lineno">618</tt>  <tt class="py-line"> </tt>
<a name="L619"></a><tt class="py-lineno">619</tt>  <tt class="py-line">        <tt class="py-keyword">def</tt> <tt class="py-def-name">objf</tt><tt class="py-op">(</tt><tt class="py-param">y</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L620"></a><tt class="py-lineno">620</tt>  <tt class="py-line">                <tt class="py-comment"># construct piece-wise linear function</tt> </tt>
<a name="L621"></a><tt class="py-lineno">621</tt>  <tt class="py-line">                <tt class="py-name">f</tt> <tt class="py-op">=</tt> <tt class="py-name">interp1d</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">,</tt> <tt class="py-name">y</tt><tt class="py-op">)</tt> </tt>
<a name="L622"></a><tt class="py-lineno">622</tt>  <tt class="py-line"> </tt>
<a name="L623"></a><tt class="py-lineno">623</tt>  <tt class="py-line">                <tt class="py-comment"># compute predicted firing rates</tt> </tt>
<a name="L624"></a><tt class="py-lineno">624</tt>  <tt class="py-line">                <tt class="py-name">l</tt> <tt class="py-op">=</tt> <tt class="py-name">f</tt><tt class="py-op">(</tt><tt class="py-name">predictions</tt><tt class="py-op">)</tt> <tt class="py-op">+</tt> <tt class="py-number">1e-16</tt> </tt>
<a name="L625"></a><tt class="py-lineno">625</tt>  <tt class="py-line"> </tt>
<a name="L626"></a><tt class="py-lineno">626</tt>  <tt class="py-line">                <tt class="py-comment"># compute negative log-likelihood (ignoring constants)</tt> </tt>
<a name="L627"></a><tt class="py-lineno">627</tt>  <tt class="py-line">                <tt class="py-name">K</tt> <tt class="py-op">=</tt> <tt class="py-name">mean</tt><tt class="py-op">(</tt><tt class="py-name">l</tt> <tt class="py-op">-</tt> <tt class="py-name">spikes</tt> <tt class="py-op">*</tt> <tt class="py-name">log</tt><tt class="py-op">(</tt><tt class="py-name">l</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L628"></a><tt class="py-lineno">628</tt>  <tt class="py-line">                 </tt>
<a name="L629"></a><tt class="py-lineno">629</tt>  <tt class="py-line">                <tt class="py-comment"># regularize curvature</tt> </tt>
<a name="L630"></a><tt class="py-lineno">630</tt>  <tt class="py-line">                <tt class="py-name">z</tt> <tt class="py-op">=</tt> <tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">[</tt><tt class="py-number">2</tt><tt class="py-op">:</tt><tt class="py-op">]</tt> <tt class="py-op">-</tt> <tt class="py-name">x</tt><tt class="py-op">[</tt><tt class="py-op">:</tt><tt class="py-op">-</tt><tt class="py-number">2</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> <tt class="py-op">/</tt> <tt class="py-number">2.</tt> </tt>
<a name="L631"></a><tt class="py-lineno">631</tt>  <tt class="py-line">                <tt class="py-name">K</tt> <tt class="py-op">=</tt> <tt class="py-name">K</tt> <tt class="py-op">+</tt> <tt class="py-name">regularize</tt> <tt class="py-op">*</tt> <tt class="py-name">sum</tt><tt class="py-op">(</tt><tt class="py-name">square</tt><tt class="py-op">(</tt><tt class="py-name">diff</tt><tt class="py-op">(</tt><tt class="py-name">diff</tt><tt class="py-op">(</tt><tt class="py-name">y</tt><tt class="py-op">)</tt> <tt class="py-op">/</tt> <tt class="py-name">diff</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-op">/</tt> <tt class="py-name">z</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L632"></a><tt class="py-lineno">632</tt>  <tt class="py-line"> </tt>
<a name="L633"></a><tt class="py-lineno">633</tt>  <tt class="py-line">                <tt class="py-keyword">return</tt> <tt class="py-name">K</tt> </tt>
</div><a name="L634"></a><tt class="py-lineno">634</tt>  <tt class="py-line"> </tt>
<a name="L635"></a><tt class="py-lineno">635</tt>  <tt class="py-line">        <tt class="py-keyword">class</tt> <tt class="py-def-name">MonotonicityConstraint</tt><tt class="py-op">:</tt> </tt>
<a name="L636"></a><tt class="py-lineno">636</tt>  <tt class="py-line">                <tt class="py-keyword">def</tt> <tt class="py-def-name">__init__</tt><tt class="py-op">(</tt><tt class="py-param">self</tt><tt class="py-op">,</tt> <tt class="py-param">i</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L637"></a><tt class="py-lineno">637</tt>  <tt class="py-line">                        <tt class="py-name">self</tt><tt class="py-op">.</tt><tt class="py-name">i</tt> <tt class="py-op">=</tt> <tt class="py-name">i</tt> </tt>
</div><a name="L638"></a><tt class="py-lineno">638</tt>  <tt class="py-line"> </tt>
<a name="L639"></a><tt class="py-lineno">639</tt>  <tt class="py-line">                <tt class="py-keyword">def</tt> <tt class="py-def-name">__call__</tt><tt class="py-op">(</tt><tt class="py-param">self</tt><tt class="py-op">,</tt> <tt class="py-param">y</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L640"></a><tt class="py-lineno">640</tt>  <tt class="py-line">                        <tt class="py-keyword">return</tt> <tt class="py-name">y</tt><tt class="py-op">[</tt><tt class="py-name">self</tt><tt class="py-op">.</tt><tt class="py-name">i</tt><tt class="py-op">]</tt> <tt class="py-op">-</tt> <tt class="py-name">y</tt><tt class="py-op">[</tt><tt class="py-name">self</tt><tt class="py-op">.</tt><tt class="py-name">i</tt> <tt class="py-op">-</tt> <tt class="py-number">1</tt><tt class="py-op">]</tt> </tt>
</div></div><a name="L641"></a><tt class="py-lineno">641</tt>  <tt class="py-line"> </tt>
<a name="L642"></a><tt class="py-lineno">642</tt>  <tt class="py-line">        <tt class="py-comment"># monotonicity and non-negativity constraint</tt> </tt>
<a name="L643"></a><tt class="py-lineno">643</tt>  <tt class="py-line">        <tt class="py-name">constraints</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-op">{</tt><tt class="py-string">'type'</tt><tt class="py-op">:</tt> <tt class="py-string">'ineq'</tt><tt class="py-op">,</tt> <tt class="py-string">'fun'</tt><tt class="py-op">:</tt> <tt class="py-name">MonotonicityConstraint</tt><tt class="py-op">(</tt><tt class="py-name">i</tt><tt class="py-op">)</tt><tt class="py-op">}</tt> <tt class="py-keyword">for</tt> <tt class="py-name">i</tt> <tt class="py-keyword">in</tt> <tt class="py-name">range</tt><tt class="py-op">(</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-name">x</tt><tt class="py-op">.</tt><tt class="py-name">size</tt><tt class="py-op">)</tt><tt class="py-op">]</tt> </tt>
<a name="L644"></a><tt class="py-lineno">644</tt>  <tt class="py-line">        <tt class="py-name">constraints</tt><tt class="py-op">.</tt><tt class="py-name">extend</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-op">{</tt><tt class="py-string">'type'</tt><tt class="py-op">:</tt> <tt class="py-string">'ineq'</tt><tt class="py-op">,</tt> <tt class="py-string">'fun'</tt><tt class="py-op">:</tt> <tt class="py-keyword">lambda</tt> <tt class="py-name">y</tt><tt class="py-op">:</tt> <tt class="py-name">y</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">}</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L645"></a><tt class="py-lineno">645</tt>  <tt class="py-line"> </tt>
<a name="L646"></a><tt class="py-lineno">646</tt>  <tt class="py-line">        <tt class="py-comment"># fit monotonic function</tt> </tt>
<a name="L647"></a><tt class="py-lineno">647</tt>  <tt class="py-line">        <tt class="py-name">res</tt> <tt class="py-op">=</tt> <tt class="py-name">minimize</tt><tt class="py-op">(</tt> </tt>
<a name="L648"></a><tt class="py-lineno">648</tt>  <tt class="py-line">                <tt class="py-name">fun</tt><tt class="py-op">=</tt><tt class="py-name">objf</tt><tt class="py-op">,</tt> </tt>
<a name="L649"></a><tt class="py-lineno">649</tt>  <tt class="py-line">                <tt class="py-name">x0</tt><tt class="py-op">=</tt><tt class="py-name">x</tt> <tt class="py-op">+</tt> <tt class="py-number">1e-6</tt><tt class="py-op">,</tt> </tt>
<a name="L650"></a><tt class="py-lineno">650</tt>  <tt class="py-line">                <tt class="py-name">method</tt><tt class="py-op">=</tt><tt class="py-string">'SLSQP'</tt><tt class="py-op">,</tt> </tt>
<a name="L651"></a><tt class="py-lineno">651</tt>  <tt class="py-line">                <tt class="py-name">tol</tt><tt class="py-op">=</tt><tt class="py-number">1e-9</tt><tt class="py-op">,</tt> </tt>
<a name="L652"></a><tt class="py-lineno">652</tt>  <tt class="py-line">                <tt class="py-name">constraints</tt><tt class="py-op">=</tt><tt class="py-name">constraints</tt><tt class="py-op">,</tt> </tt>
<a name="L653"></a><tt class="py-lineno">653</tt>  <tt class="py-line">                <tt class="py-name">options</tt><tt class="py-op">=</tt><tt class="py-op">{</tt><tt class="py-string">'disp'</tt><tt class="py-op">:</tt> <tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-string">'iprint'</tt><tt class="py-op">:</tt> <tt class="py-name">verbosity</tt><tt class="py-op">}</tt><tt class="py-op">)</tt> </tt>
<a name="L654"></a><tt class="py-lineno">654</tt>  <tt class="py-line"> </tt>
<a name="L655"></a><tt class="py-lineno">655</tt>  <tt class="py-line">        <tt class="py-comment"># construct monotonic piecewise linear function</tt> </tt>
<a name="L656"></a><tt class="py-lineno">656</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt> <tt class="py-name">interp1d</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">,</tt> <tt class="py-name">res</tt><tt class="py-op">.</tt><tt class="py-name">x</tt><tt class="py-op">,</tt> <tt class="py-name">bounds_error</tt><tt class="py-op">=</tt><tt class="py-name">False</tt><tt class="py-op">,</tt> <tt class="py-name">fill_value</tt><tt class="py-op">=</tt><tt class="py-name">res</tt><tt class="py-op">.</tt><tt class="py-name">x</tt><tt class="py-op">[</tt><tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
</div><a name="L657"></a><tt class="py-lineno">657</tt>  <tt class="py-line"> </tt>
<a name="L658"></a><tt class="py-lineno">658</tt>  <tt class="py-line"> </tt>
<a name="L659"></a><tt class="py-lineno">659</tt>  <tt class="py-line"> </tt>
<a name="robust_linear_regression"></a><div id="robust_linear_regression-def"><a name="L660"></a><tt class="py-lineno">660</tt> <a class="py-toggle" href="#" id="robust_linear_regression-toggle" onclick="return toggle('robust_linear_regression');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="c2s.c2s-module.html#robust_linear_regression">robust_linear_regression</a><tt class="py-op">(</tt><tt class="py-param">x</tt><tt class="py-op">,</tt> <tt class="py-param">y</tt><tt class="py-op">,</tt> <tt class="py-param">num_scales</tt><tt class="py-op">=</tt><tt class="py-number">3</tt><tt class="py-op">,</tt> <tt class="py-param">max_iter</tt><tt class="py-op">=</tt><tt class="py-number">1000</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="robust_linear_regression-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="robust_linear_regression-expanded"><a name="L661"></a><tt class="py-lineno">661</tt>  <tt class="py-line">        <tt class="py-docstring">"""</tt> </tt>
<a name="L662"></a><tt class="py-lineno">662</tt>  <tt class="py-line"><tt class="py-docstring">        Performs linear regression with Gaussian scale mixture residuals. </tt> </tt>
<a name="L663"></a><tt class="py-lineno">663</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L664"></a><tt class="py-lineno">664</tt>  <tt class="py-line"><tt class="py-docstring">        $$y = ax + b + \\varepsilon,$$</tt> </tt>
<a name="L665"></a><tt class="py-lineno">665</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L666"></a><tt class="py-lineno">666</tt>  <tt class="py-line"><tt class="py-docstring">        where $\\varepsilon$ is assumed to be Gaussian scale mixture distributed.</tt> </tt>
<a name="L667"></a><tt class="py-lineno">667</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L668"></a><tt class="py-lineno">668</tt>  <tt class="py-line"><tt class="py-docstring">        @type  x: array_like</tt> </tt>
<a name="L669"></a><tt class="py-lineno">669</tt>  <tt class="py-line"><tt class="py-docstring">        @param x: list of one-dimensional inputs</tt> </tt>
<a name="L670"></a><tt class="py-lineno">670</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L671"></a><tt class="py-lineno">671</tt>  <tt class="py-line"><tt class="py-docstring">        @type  y: array_like</tt> </tt>
<a name="L672"></a><tt class="py-lineno">672</tt>  <tt class="py-line"><tt class="py-docstring">        @param y: list of one-dimensional outputs</tt> </tt>
<a name="L673"></a><tt class="py-lineno">673</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L674"></a><tt class="py-lineno">674</tt>  <tt class="py-line"><tt class="py-docstring">        @type  num_scales: int</tt> </tt>
<a name="L675"></a><tt class="py-lineno">675</tt>  <tt class="py-line"><tt class="py-docstring">        @param num_scales: number of Gaussian scale mixture components</tt> </tt>
<a name="L676"></a><tt class="py-lineno">676</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L677"></a><tt class="py-lineno">677</tt>  <tt class="py-line"><tt class="py-docstring">        @type  max_iter: int</tt> </tt>
<a name="L678"></a><tt class="py-lineno">678</tt>  <tt class="py-line"><tt class="py-docstring">        @param max_iter: number of optimization steps in parameter search</tt> </tt>
<a name="L679"></a><tt class="py-lineno">679</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L680"></a><tt class="py-lineno">680</tt>  <tt class="py-line"><tt class="py-docstring">        @rtype: tuple</tt> </tt>
<a name="L681"></a><tt class="py-lineno">681</tt>  <tt class="py-line"><tt class="py-docstring">        @return: slope and y-intercept</tt> </tt>
<a name="L682"></a><tt class="py-lineno">682</tt>  <tt class="py-line"><tt class="py-docstring">        """</tt> </tt>
<a name="L683"></a><tt class="py-lineno">683</tt>  <tt class="py-line"> </tt>
<a name="L684"></a><tt class="py-lineno">684</tt>  <tt class="py-line">        <tt class="py-name">x</tt> <tt class="py-op">=</tt> <tt class="py-name">asarray</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">reshape</tt><tt class="py-op">(</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">)</tt> </tt>
<a name="L685"></a><tt class="py-lineno">685</tt>  <tt class="py-line">        <tt class="py-name">y</tt> <tt class="py-op">=</tt> <tt class="py-name">asarray</tt><tt class="py-op">(</tt><tt class="py-name">y</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">reshape</tt><tt class="py-op">(</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-op">-</tt><tt class="py-number">1</tt><tt class="py-op">)</tt> </tt>
<a name="L686"></a><tt class="py-lineno">686</tt>  <tt class="py-line"> </tt>
<a name="L687"></a><tt class="py-lineno">687</tt>  <tt class="py-line">        <tt class="py-comment"># preprocess inputs</tt> </tt>
<a name="L688"></a><tt class="py-lineno">688</tt>  <tt class="py-line">        <tt class="py-name">m</tt> <tt class="py-op">=</tt> <tt class="py-name">mean</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">)</tt> </tt>
<a name="L689"></a><tt class="py-lineno">689</tt>  <tt class="py-line">        <tt class="py-name">s</tt> <tt class="py-op">=</tt> <tt class="py-name">std</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">)</tt> </tt>
<a name="L690"></a><tt class="py-lineno">690</tt>  <tt class="py-line"> </tt>
<a name="L691"></a><tt class="py-lineno">691</tt>  <tt class="py-line">        <tt class="py-name">x</tt> <tt class="py-op">=</tt> <tt class="py-op">(</tt><tt class="py-name">x</tt> <tt class="py-op">-</tt> <tt class="py-name">m</tt><tt class="py-op">)</tt> <tt class="py-op">/</tt> <tt class="py-name">s</tt> </tt>
<a name="L692"></a><tt class="py-lineno">692</tt>  <tt class="py-line"> </tt>
<a name="L693"></a><tt class="py-lineno">693</tt>  <tt class="py-line">        <tt class="py-comment"># preprocess outputs using simple linear regression</tt> </tt>
<a name="L694"></a><tt class="py-lineno">694</tt>  <tt class="py-line">        <tt class="py-name">C</tt> <tt class="py-op">=</tt> <tt class="py-name">cov</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">,</tt> <tt class="py-name">y</tt><tt class="py-op">)</tt> </tt>
<a name="L695"></a><tt class="py-lineno">695</tt>  <tt class="py-line">        <tt class="py-name">a</tt> <tt class="py-op">=</tt> <tt class="py-name">C</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">,</tt> <tt class="py-number">1</tt><tt class="py-op">]</tt> <tt class="py-op">/</tt> <tt class="py-name">C</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">,</tt> <tt class="py-number">0</tt><tt class="py-op">]</tt> </tt>
<a name="L696"></a><tt class="py-lineno">696</tt>  <tt class="py-line">        <tt class="py-name">b</tt> <tt class="py-op">=</tt> <tt class="py-name">mean</tt><tt class="py-op">(</tt><tt class="py-name">y</tt><tt class="py-op">)</tt> <tt class="py-op">-</tt> <tt class="py-name">a</tt> <tt class="py-op">*</tt> <tt class="py-name">mean</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">)</tt> </tt>
<a name="L697"></a><tt class="py-lineno">697</tt>  <tt class="py-line"> </tt>
<a name="L698"></a><tt class="py-lineno">698</tt>  <tt class="py-line">        <tt class="py-name">y</tt> <tt class="py-op">=</tt> <tt class="py-name">y</tt> <tt class="py-op">-</tt> <tt class="py-op">(</tt><tt class="py-name">a</tt> <tt class="py-op">*</tt> <tt class="py-name">x</tt> <tt class="py-op">+</tt> <tt class="py-name">b</tt><tt class="py-op">)</tt> </tt>
<a name="L699"></a><tt class="py-lineno">699</tt>  <tt class="py-line"> </tt>
<a name="L700"></a><tt class="py-lineno">700</tt>  <tt class="py-line">        <tt class="py-comment"># robust linear regression</tt> </tt>
<a name="L701"></a><tt class="py-lineno">701</tt>  <tt class="py-line">        <tt class="py-name">model</tt> <tt class="py-op">=</tt> <tt class="py-name">MCGSM</tt><tt class="py-op">(</tt> </tt>
<a name="L702"></a><tt class="py-lineno">702</tt>  <tt class="py-line">                <tt class="py-name">dim_in</tt><tt class="py-op">=</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> </tt>
<a name="L703"></a><tt class="py-lineno">703</tt>  <tt class="py-line">                <tt class="py-name">dim_out</tt><tt class="py-op">=</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> </tt>
<a name="L704"></a><tt class="py-lineno">704</tt>  <tt class="py-line">                <tt class="py-name">num_components</tt><tt class="py-op">=</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> </tt>
<a name="L705"></a><tt class="py-lineno">705</tt>  <tt class="py-line">                <tt class="py-name">num_scales</tt><tt class="py-op">=</tt><tt class="py-name">num_scales</tt><tt class="py-op">,</tt> </tt>
<a name="L706"></a><tt class="py-lineno">706</tt>  <tt class="py-line">                <tt class="py-name">num_features</tt><tt class="py-op">=</tt><tt class="py-number">0</tt><tt class="py-op">)</tt> </tt>
<a name="L707"></a><tt class="py-lineno">707</tt>  <tt class="py-line"> </tt>
<a name="L708"></a><tt class="py-lineno">708</tt>  <tt class="py-line">        <tt class="py-name">model</tt><tt class="py-op">.</tt><tt class="py-name">initialize</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">,</tt> <tt class="py-name">y</tt><tt class="py-op">)</tt> </tt>
<a name="L709"></a><tt class="py-lineno">709</tt>  <tt class="py-line">        <tt class="py-name">model</tt><tt class="py-op">.</tt><tt id="link-5" class="py-name"><a title="c2s.c2s.train" class="py-name" href="#" onclick="return doclink('link-5', 'train', 'link-0');">train</a></tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">,</tt> <tt class="py-name">y</tt><tt class="py-op">,</tt> <tt class="py-name">parameters</tt><tt class="py-op">=</tt><tt class="py-op">{</tt> </tt>
<a name="L710"></a><tt class="py-lineno">710</tt>  <tt class="py-line">                <tt class="py-string">'train_means'</tt><tt class="py-op">:</tt> <tt class="py-name">True</tt><tt class="py-op">,</tt> </tt>
<a name="L711"></a><tt class="py-lineno">711</tt>  <tt class="py-line">                <tt class="py-string">'max_iter'</tt><tt class="py-op">:</tt> <tt class="py-name">max_iter</tt><tt class="py-op">}</tt><tt class="py-op">)</tt> </tt>
<a name="L712"></a><tt class="py-lineno">712</tt>  <tt class="py-line"> </tt>
<a name="L713"></a><tt class="py-lineno">713</tt>  <tt class="py-line">        <tt class="py-name">a</tt> <tt class="py-op">=</tt> <tt class="py-op">(</tt><tt class="py-name">a</tt> <tt class="py-op">+</tt> <tt class="py-name">float</tt><tt class="py-op">(</tt><tt class="py-name">model</tt><tt class="py-op">.</tt><tt class="py-name">predictors</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-op">/</tt> <tt class="py-name">s</tt> </tt>
<a name="L714"></a><tt class="py-lineno">714</tt>  <tt class="py-line">        <tt class="py-name">b</tt> <tt class="py-op">=</tt> <tt class="py-op">(</tt><tt class="py-name">b</tt> <tt class="py-op">+</tt> <tt class="py-name">float</tt><tt class="py-op">(</tt><tt class="py-name">model</tt><tt class="py-op">.</tt><tt class="py-name">means</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> <tt class="py-op">-</tt> <tt class="py-name">a</tt> <tt class="py-op">*</tt> <tt class="py-name">m</tt> </tt>
<a name="L715"></a><tt class="py-lineno">715</tt>  <tt class="py-line"> </tt>
<a name="L716"></a><tt class="py-lineno">716</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt> <tt class="py-name">a</tt><tt class="py-op">,</tt> <tt class="py-name">b</tt> </tt>
</div><a name="L717"></a><tt class="py-lineno">717</tt>  <tt class="py-line"> </tt>
<a name="L718"></a><tt class="py-lineno">718</tt>  <tt class="py-line"> </tt>
<a name="L719"></a><tt class="py-lineno">719</tt>  <tt class="py-line"> </tt>
<a name="percentile_filter"></a><div id="percentile_filter-def"><a name="L720"></a><tt class="py-lineno">720</tt> <a class="py-toggle" href="#" id="percentile_filter-toggle" onclick="return toggle('percentile_filter');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="c2s.c2s-module.html#percentile_filter">percentile_filter</a><tt class="py-op">(</tt><tt class="py-param">x</tt><tt class="py-op">,</tt> <tt class="py-param">window_length</tt><tt class="py-op">,</tt> <tt class="py-param">perc</tt><tt class="py-op">=</tt><tt class="py-number">5</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="percentile_filter-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="percentile_filter-expanded"><a name="L721"></a><tt class="py-lineno">721</tt>  <tt class="py-line">        <tt class="py-docstring">"""</tt> </tt>
<a name="L722"></a><tt class="py-lineno">722</tt>  <tt class="py-line"><tt class="py-docstring">        For each point in a signal, computes a percentile from a window surrounding it.</tt> </tt>
<a name="L723"></a><tt class="py-lineno">723</tt>  <tt class="py-line"><tt class="py-docstring">        """</tt> </tt>
<a name="L724"></a><tt class="py-lineno">724</tt>  <tt class="py-line"> </tt>
<a name="L725"></a><tt class="py-lineno">725</tt>  <tt class="py-line">        <tt class="py-name">y</tt> <tt class="py-op">=</tt> <tt class="py-name">empty_like</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">)</tt> </tt>
<a name="L726"></a><tt class="py-lineno">726</tt>  <tt class="py-line">        <tt class="py-name">d</tt> <tt class="py-op">=</tt> <tt class="py-name">window_length</tt> <tt class="py-op">//</tt> <tt class="py-number">2</tt> <tt class="py-op">+</tt> <tt class="py-number">1</tt> </tt>
<a name="L727"></a><tt class="py-lineno">727</tt>  <tt class="py-line"> </tt>
<a name="L728"></a><tt class="py-lineno">728</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">t</tt> <tt class="py-keyword">in</tt> <tt class="py-name">range</tt><tt class="py-op">(</tt><tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">)</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L729"></a><tt class="py-lineno">729</tt>  <tt class="py-line">                <tt class="py-name">fr</tt> <tt class="py-op">=</tt> <tt class="py-name">max</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-name">t</tt> <tt class="py-op">-</tt> <tt class="py-name">d</tt> <tt class="py-op">+</tt> <tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L730"></a><tt class="py-lineno">730</tt>  <tt class="py-line">                <tt class="py-name">to</tt> <tt class="py-op">=</tt> <tt class="py-name">t</tt> <tt class="py-op">+</tt> <tt class="py-name">d</tt> </tt>
<a name="L731"></a><tt class="py-lineno">731</tt>  <tt class="py-line">                <tt class="py-name">y</tt><tt class="py-op">[</tt><tt class="py-name">t</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">percentile</tt><tt class="py-op">(</tt><tt class="py-name">x</tt><tt class="py-op">[</tt><tt class="py-name">fr</tt><tt class="py-op">:</tt><tt class="py-name">to</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">perc</tt><tt class="py-op">)</tt> </tt>
<a name="L732"></a><tt class="py-lineno">732</tt>  <tt class="py-line"> </tt>
<a name="L733"></a><tt class="py-lineno">733</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt> <tt class="py-name">y</tt> </tt>
</div><a name="L734"></a><tt class="py-lineno">734</tt>  <tt class="py-line"> </tt>
<a name="L735"></a><tt class="py-lineno">735</tt>  <tt class="py-line"> </tt>
<a name="L736"></a><tt class="py-lineno">736</tt>  <tt class="py-line"> </tt>
<a name="downsample"></a><div id="downsample-def"><a name="L737"></a><tt class="py-lineno">737</tt> <a class="py-toggle" href="#" id="downsample-toggle" onclick="return toggle('downsample');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="c2s.c2s-module.html#downsample">downsample</a><tt class="py-op">(</tt><tt class="py-param">signal</tt><tt class="py-op">,</tt> <tt class="py-param">factor</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="downsample-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="downsample-expanded"><a name="L738"></a><tt class="py-lineno">738</tt>  <tt class="py-line">        <tt class="py-docstring">"""</tt> </tt>
<a name="L739"></a><tt class="py-lineno">739</tt>  <tt class="py-line"><tt class="py-docstring">        Downsample signal by averaging neighboring values.</tt> </tt>
<a name="L740"></a><tt class="py-lineno">740</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L741"></a><tt class="py-lineno">741</tt>  <tt class="py-line"><tt class="py-docstring">        @type  signal: array_like</tt> </tt>
<a name="L742"></a><tt class="py-lineno">742</tt>  <tt class="py-line"><tt class="py-docstring">        @param signal: one-dimensional signal to be downsampled</tt> </tt>
<a name="L743"></a><tt class="py-lineno">743</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L744"></a><tt class="py-lineno">744</tt>  <tt class="py-line"><tt class="py-docstring">        @type  factor: int</tt> </tt>
<a name="L745"></a><tt class="py-lineno">745</tt>  <tt class="py-line"><tt class="py-docstring">        @param factor: this many neighboring values are averaged</tt> </tt>
<a name="L746"></a><tt class="py-lineno">746</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L747"></a><tt class="py-lineno">747</tt>  <tt class="py-line"><tt class="py-docstring">        @rtype: ndarray</tt> </tt>
<a name="L748"></a><tt class="py-lineno">748</tt>  <tt class="py-line"><tt class="py-docstring">        @return: downsampled signal</tt> </tt>
<a name="L749"></a><tt class="py-lineno">749</tt>  <tt class="py-line"><tt class="py-docstring">        """</tt> </tt>
<a name="L750"></a><tt class="py-lineno">750</tt>  <tt class="py-line"> </tt>
<a name="L751"></a><tt class="py-lineno">751</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">factor</tt> <tt class="py-op">&lt;</tt> <tt class="py-number">2</tt><tt class="py-op">:</tt> </tt>
<a name="L752"></a><tt class="py-lineno">752</tt>  <tt class="py-line">                <tt class="py-keyword">return</tt> <tt class="py-name">asarray</tt><tt class="py-op">(</tt><tt class="py-name">signal</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">ravel</tt><tt class="py-op">(</tt><tt class="py-op">)</tt> </tt>
<a name="L753"></a><tt class="py-lineno">753</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt> <tt class="py-name">convolve</tt><tt class="py-op">(</tt><tt class="py-name">asarray</tt><tt class="py-op">(</tt><tt class="py-name">signal</tt><tt class="py-op">)</tt><tt class="py-op">.</tt><tt class="py-name">ravel</tt><tt class="py-op">(</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">ones</tt><tt class="py-op">(</tt><tt class="py-name">factor</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-string">'valid'</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-op">:</tt><tt class="py-op">:</tt><tt class="py-name">factor</tt><tt class="py-op">]</tt> </tt>
</div><a name="L754"></a><tt class="py-lineno">754</tt>  <tt class="py-line"> </tt>
<a name="L755"></a><tt class="py-lineno">755</tt>  <tt class="py-line"> </tt>
<a name="L756"></a><tt class="py-lineno">756</tt>  <tt class="py-line"> </tt>
<a name="responses"></a><div id="responses-def"><a name="L757"></a><tt class="py-lineno">757</tt> <a class="py-toggle" href="#" id="responses-toggle" onclick="return toggle('responses');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="c2s.c2s-module.html#responses">responses</a><tt class="py-op">(</tt><tt class="py-param">data</tt><tt class="py-op">,</tt> <tt class="py-param">results</tt><tt class="py-op">,</tt> <tt class="py-param">verbosity</tt><tt class="py-op">=</tt><tt class="py-number">0</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="responses-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="responses-expanded"><a name="L758"></a><tt class="py-lineno">758</tt>  <tt class="py-line">        <tt class="py-docstring">"""</tt> </tt>
<a name="L759"></a><tt class="py-lineno">759</tt>  <tt class="py-line"><tt class="py-docstring">        Compute nonlinear component responses of STM to calcium.</tt> </tt>
<a name="L760"></a><tt class="py-lineno">760</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L761"></a><tt class="py-lineno">761</tt>  <tt class="py-line"><tt class="py-docstring">        @type  data: list</tt> </tt>
<a name="L762"></a><tt class="py-lineno">762</tt>  <tt class="py-line"><tt class="py-docstring">        @param data: list of dictionaries containing calcium/fluorescence traces</tt> </tt>
<a name="L763"></a><tt class="py-lineno">763</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L764"></a><tt class="py-lineno">764</tt>  <tt class="py-line"><tt class="py-docstring">        @type  results: dict</tt> </tt>
<a name="L765"></a><tt class="py-lineno">765</tt>  <tt class="py-line"><tt class="py-docstring">        @param results: dictionary containing results of training procedure</tt> </tt>
<a name="L766"></a><tt class="py-lineno">766</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L767"></a><tt class="py-lineno">767</tt>  <tt class="py-line"><tt class="py-docstring">        @type  verbosity: int</tt> </tt>
<a name="L768"></a><tt class="py-lineno">768</tt>  <tt class="py-line"><tt class="py-docstring">        @param verbosity: if positive, print messages indicating progress</tt> </tt>
<a name="L769"></a><tt class="py-lineno">769</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L770"></a><tt class="py-lineno">770</tt>  <tt class="py-line"><tt class="py-docstring">        @rtype: list</tt> </tt>
<a name="L771"></a><tt class="py-lineno">771</tt>  <tt class="py-line"><tt class="py-docstring">        @return: list of dictionaries as input, but with added responses</tt> </tt>
<a name="L772"></a><tt class="py-lineno">772</tt>  <tt class="py-line"><tt class="py-docstring">        """</tt> </tt>
<a name="L773"></a><tt class="py-lineno">773</tt>  <tt class="py-line"> </tt>
<a name="L774"></a><tt class="py-lineno">774</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">type</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> <tt class="py-keyword">is</tt> <tt class="py-name">dict</tt><tt class="py-op">:</tt> </tt>
<a name="L775"></a><tt class="py-lineno">775</tt>  <tt class="py-line">                <tt class="py-name">data</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-name">data</tt><tt class="py-op">]</tt> </tt>
<a name="L776"></a><tt class="py-lineno">776</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">type</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> <tt class="py-keyword">is</tt> <tt class="py-keyword">not</tt> <tt class="py-name">list</tt> <tt class="py-keyword">or</tt> <tt class="py-op">(</tt><tt class="py-name">len</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt> <tt class="py-keyword">and</tt> <tt class="py-name">type</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> <tt class="py-keyword">is</tt> <tt class="py-keyword">not</tt> <tt class="py-name">dict</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L777"></a><tt class="py-lineno">777</tt>  <tt class="py-line">                <tt class="py-name">data</tt> <tt class="py-op">=</tt> <tt class="py-op">[</tt><tt class="py-op">{</tt><tt class="py-string">'calcium'</tt><tt class="py-op">:</tt> <tt class="py-name">data</tt><tt class="py-op">}</tt><tt class="py-op">]</tt> </tt>
<a name="L778"></a><tt class="py-lineno">778</tt>  <tt class="py-line"> </tt>
<a name="L779"></a><tt class="py-lineno">779</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">:</tt> </tt>
<a name="L780"></a><tt class="py-lineno">780</tt>  <tt class="py-line">                <tt class="py-comment"># extract windows from fluorescence trace and reduce dimensionality</tt> </tt>
<a name="L781"></a><tt class="py-lineno">781</tt>  <tt class="py-line">                <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">extract_windows</tt><tt class="py-op">(</tt> </tt>
<a name="L782"></a><tt class="py-lineno">782</tt>  <tt class="py-line">                        <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">sum</tt><tt class="py-op">(</tt><tt class="py-name">results</tt><tt class="py-op">[</tt><tt class="py-string">'input_mask'</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">)</tt> </tt>
<a name="L783"></a><tt class="py-lineno">783</tt>  <tt class="py-line">                <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">results</tt><tt class="py-op">[</tt><tt class="py-string">'pca'</tt><tt class="py-op">]</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L784"></a><tt class="py-lineno">784</tt>  <tt class="py-line"> </tt>
<a name="L785"></a><tt class="py-lineno">785</tt>  <tt class="py-line">        <tt class="py-name">pad_left</tt>  <tt class="py-op">=</tt> <tt class="py-name">int</tt><tt class="py-op">(</tt><tt class="py-name">where</tt><tt class="py-op">(</tt><tt class="py-name">results</tt><tt class="py-op">[</tt><tt class="py-string">'output_mask'</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt> <tt class="py-op">+</tt> <tt class="py-number">.5</tt><tt class="py-op">)</tt> </tt>
<a name="L786"></a><tt class="py-lineno">786</tt>  <tt class="py-line">        <tt class="py-name">pad_right</tt> <tt class="py-op">=</tt> <tt class="py-name">results</tt><tt class="py-op">[</tt><tt class="py-string">'output_mask'</tt><tt class="py-op">]</tt><tt class="py-op">.</tt><tt class="py-name">shape</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">]</tt> <tt class="py-op">-</tt> <tt class="py-name">pad_left</tt> <tt class="py-op">-</tt> <tt class="py-number">1</tt> </tt>
<a name="L787"></a><tt class="py-lineno">787</tt>  <tt class="py-line"> </tt>
<a name="L788"></a><tt class="py-lineno">788</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">k</tt><tt class="py-op">,</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">enumerate</tt><tt class="py-op">(</tt><tt class="py-name">data</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
<a name="L789"></a><tt class="py-lineno">789</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L790"></a><tt class="py-lineno">790</tt>  <tt class="py-line">                        <tt class="py-keyword">print</tt> <tt class="py-string">'Computing responses for cell {0}...'</tt><tt class="py-op">.</tt><tt class="py-name">format</tt><tt class="py-op">(</tt><tt class="py-name">k</tt><tt class="py-op">)</tt> </tt>
<a name="L791"></a><tt class="py-lineno">791</tt>  <tt class="py-line"> </tt>
<a name="L792"></a><tt class="py-lineno">792</tt>  <tt class="py-line">                <tt class="py-comment"># pick first model</tt> </tt>
<a name="L793"></a><tt class="py-lineno">793</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">type</tt><tt class="py-op">(</tt><tt class="py-name">results</tt><tt class="py-op">)</tt> <tt class="py-keyword">is</tt> <tt class="py-name">STM</tt><tt class="py-op">:</tt> </tt>
<a name="L794"></a><tt class="py-lineno">794</tt>  <tt class="py-line">                        <tt class="py-name">model</tt> <tt class="py-op">=</tt> <tt class="py-name">results</tt> </tt>
<a name="L795"></a><tt class="py-lineno">795</tt>  <tt class="py-line">                <tt class="py-keyword">else</tt><tt class="py-op">:</tt> </tt>
<a name="L796"></a><tt class="py-lineno">796</tt>  <tt class="py-line">                        <tt class="py-name">model</tt> <tt class="py-op">=</tt> <tt class="py-name">results</tt><tt class="py-op">[</tt><tt class="py-string">'models'</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt> </tt>
<a name="L797"></a><tt class="py-lineno">797</tt>  <tt class="py-line"> </tt>
<a name="L798"></a><tt class="py-lineno">798</tt>  <tt class="py-line">                <tt class="py-comment"># compute nonlinear component responses</tt> </tt>
<a name="L799"></a><tt class="py-lineno">799</tt>  <tt class="py-line">                <tt class="py-name">responses</tt> <tt class="py-op">=</tt> <tt class="py-name">model</tt><tt class="py-op">.</tt><tt class="py-name">nonlinear_responses</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L800"></a><tt class="py-lineno">800</tt>  <tt class="py-line"> </tt>
<a name="L801"></a><tt class="py-lineno">801</tt>  <tt class="py-line">                <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'responses'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-op">[</tt> </tt>
<a name="L802"></a><tt class="py-lineno">802</tt>  <tt class="py-line">                        <tt class="py-name">zeros</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-name">responses</tt><tt class="py-op">.</tt><tt class="py-name">shape</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">pad_left</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> </tt>
<a name="L803"></a><tt class="py-lineno">803</tt>  <tt class="py-line">                        <tt class="py-name">responses</tt><tt class="py-op">,</tt> </tt>
<a name="L804"></a><tt class="py-lineno">804</tt>  <tt class="py-line">                        <tt class="py-name">zeros</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-name">responses</tt><tt class="py-op">.</tt><tt class="py-name">shape</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">pad_right</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L805"></a><tt class="py-lineno">805</tt>  <tt class="py-line"> </tt>
<a name="L806"></a><tt class="py-lineno">806</tt>  <tt class="py-line">                <tt class="py-comment"># inputs no longer needed</tt> </tt>
<a name="L807"></a><tt class="py-lineno">807</tt>  <tt class="py-line">                <tt class="py-keyword">del</tt> <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> </tt>
<a name="L808"></a><tt class="py-lineno">808</tt>  <tt class="py-line"> </tt>
<a name="L809"></a><tt class="py-lineno">809</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt> <tt class="py-name">data</tt> </tt>
</div><a name="L810"></a><tt class="py-lineno">810</tt>  <tt class="py-line"> </tt>
<a name="L811"></a><tt class="py-lineno">811</tt>  <tt class="py-line"> </tt>
<a name="L812"></a><tt class="py-lineno">812</tt>  <tt class="py-line"> </tt>
<a name="generate_inputs_and_outputs"></a><div id="generate_inputs_and_outputs-def"><a name="L813"></a><tt class="py-lineno">813</tt> <a class="py-toggle" href="#" id="generate_inputs_and_outputs-toggle" onclick="return toggle('generate_inputs_and_outputs');">-</a><tt class="py-line"><tt class="py-keyword">def</tt> <a class="py-def-name" href="c2s.c2s-module.html#generate_inputs_and_outputs">generate_inputs_and_outputs</a><tt class="py-op">(</tt><tt class="py-param">data</tt><tt class="py-op">,</tt> <tt class="py-param">var_explained</tt><tt class="py-op">=</tt><tt class="py-number">95.</tt><tt class="py-op">,</tt> <tt class="py-param">window_length</tt><tt class="py-op">=</tt><tt class="py-number">1000.</tt><tt class="py-op">,</tt> <tt class="py-param">pca</tt><tt class="py-op">=</tt><tt class="py-name">None</tt><tt class="py-op">,</tt> <tt class="py-param">verbosity</tt><tt class="py-op">=</tt><tt class="py-number">1</tt><tt class="py-op">)</tt><tt class="py-op">:</tt> </tt>
</div><div id="generate_inputs_and_outputs-collapsed" style="display:none;" pad="+++" indent="++++"></div><div id="generate_inputs_and_outputs-expanded"><a name="L814"></a><tt class="py-lineno">814</tt>  <tt class="py-line">        <tt class="py-docstring">"""</tt> </tt>
<a name="L815"></a><tt class="py-lineno">815</tt>  <tt class="py-line"><tt class="py-docstring">        Extracts input and output windows from calcium and spike traces.</tt> </tt>
<a name="L816"></a><tt class="py-lineno">816</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L817"></a><tt class="py-lineno">817</tt>  <tt class="py-line"><tt class="py-docstring">        @type  data: list</tt> </tt>
<a name="L818"></a><tt class="py-lineno">818</tt>  <tt class="py-line"><tt class="py-docstring">        @param data: list of dictionaries containig calcium/fluorescence traces</tt> </tt>
<a name="L819"></a><tt class="py-lineno">819</tt>  <tt class="py-line"><tt class="py-docstring">        </tt> </tt>
<a name="L820"></a><tt class="py-lineno">820</tt>  <tt class="py-line"><tt class="py-docstring">        @type  var_explained: float</tt> </tt>
<a name="L821"></a><tt class="py-lineno">821</tt>  <tt class="py-line"><tt class="py-docstring">        @param var_explained: controls the number of principal components used to represent calcium window</tt> </tt>
<a name="L822"></a><tt class="py-lineno">822</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L823"></a><tt class="py-lineno">823</tt>  <tt class="py-line"><tt class="py-docstring">        @type  window_length: int</tt> </tt>
<a name="L824"></a><tt class="py-lineno">824</tt>  <tt class="py-line"><tt class="py-docstring">        @param window_length: size of calcium window used as input to STM (in milliseconds)</tt> </tt>
<a name="L825"></a><tt class="py-lineno">825</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L826"></a><tt class="py-lineno">826</tt>  <tt class="py-line"><tt class="py-docstring">        @type  pca: PCATransform</tt> </tt>
<a name="L827"></a><tt class="py-lineno">827</tt>  <tt class="py-line"><tt class="py-docstring">        @param pca: if given, use results of previous PCA</tt> </tt>
<a name="L828"></a><tt class="py-lineno">828</tt>  <tt class="py-line"><tt class="py-docstring"></tt> </tt>
<a name="L829"></a><tt class="py-lineno">829</tt>  <tt class="py-line"><tt class="py-docstring">        @rtype: tuple</tt> </tt>
<a name="L830"></a><tt class="py-lineno">830</tt>  <tt class="py-line"><tt class="py-docstring">        @return: inputs, outputs and a dictionary containing window masks and PCA results</tt> </tt>
<a name="L831"></a><tt class="py-lineno">831</tt>  <tt class="py-line"><tt class="py-docstring">        """</tt> </tt>
<a name="L832"></a><tt class="py-lineno">832</tt>  <tt class="py-line"> </tt>
<a name="L833"></a><tt class="py-lineno">833</tt>  <tt class="py-line">    <tt class="py-comment"># turn milliseconds into bins</tt> </tt>
<a name="L834"></a><tt class="py-lineno">834</tt>  <tt class="py-line">        <tt class="py-name">window_length</tt> <tt class="py-op">=</tt> <tt class="py-name">int</tt><tt class="py-op">(</tt><tt class="py-name">ceil</tt><tt class="py-op">(</tt><tt class="py-name">window_length</tt> <tt class="py-op">/</tt> <tt class="py-number">1000.</tt> <tt class="py-op">*</tt> <tt class="py-name">data</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt><tt class="py-op">[</tt><tt class="py-string">'fps'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> <tt class="py-op">+</tt> <tt class="py-number">.5</tt><tt class="py-op">)</tt> <tt class="py-comment"># bins</tt> </tt>
<a name="L835"></a><tt class="py-lineno">835</tt>  <tt class="py-line"> </tt>
<a name="L836"></a><tt class="py-lineno">836</tt>  <tt class="py-line">        <tt class="py-name">input_mask</tt> <tt class="py-op">=</tt> <tt class="py-name">zeros</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-number">2</tt><tt class="py-op">,</tt> <tt class="py-name">window_length</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">dtype</tt><tt class="py-op">=</tt><tt class="py-string">'bool'</tt><tt class="py-op">)</tt> </tt>
<a name="L837"></a><tt class="py-lineno">837</tt>  <tt class="py-line">        <tt class="py-name">input_mask</tt><tt class="py-op">[</tt><tt class="py-number">0</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">True</tt> </tt>
<a name="L838"></a><tt class="py-lineno">838</tt>  <tt class="py-line"> </tt>
<a name="L839"></a><tt class="py-lineno">839</tt>  <tt class="py-line">        <tt class="py-name">output_mask</tt> <tt class="py-op">=</tt> <tt class="py-name">zeros</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-number">2</tt><tt class="py-op">,</tt> <tt class="py-name">window_length</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">dtype</tt><tt class="py-op">=</tt><tt class="py-string">'bool'</tt><tt class="py-op">)</tt> </tt>
<a name="L840"></a><tt class="py-lineno">840</tt>  <tt class="py-line">        <tt class="py-name">output_mask</tt><tt class="py-op">[</tt><tt class="py-number">1</tt><tt class="py-op">,</tt> <tt class="py-name">window_length</tt> <tt class="py-op">/</tt> <tt class="py-number">2</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">True</tt> </tt>
<a name="L841"></a><tt class="py-lineno">841</tt>  <tt class="py-line"> </tt>
<a name="L842"></a><tt class="py-lineno">842</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L843"></a><tt class="py-lineno">843</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt> <tt class="py-string">'Extracting inputs and outputs...'</tt> </tt>
<a name="L844"></a><tt class="py-lineno">844</tt>  <tt class="py-line"> </tt>
<a name="L845"></a><tt class="py-lineno">845</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">:</tt> </tt>
<a name="L846"></a><tt class="py-lineno">846</tt>  <tt class="py-line">                <tt class="py-comment"># extract windows from fluorescence trace and corresponding spike counts</tt> </tt>
<a name="L847"></a><tt class="py-lineno">847</tt>  <tt class="py-line">                <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'outputs'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">generate_data_from_image</tt><tt class="py-op">(</tt> </tt>
<a name="L848"></a><tt class="py-lineno">848</tt>  <tt class="py-line">                        <tt class="py-name">vstack</tt><tt class="py-op">(</tt><tt class="py-op">[</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'calcium'</tt><tt class="py-op">]</tt><tt class="py-op">,</tt> <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'spikes'</tt><tt class="py-op">]</tt><tt class="py-op">]</tt><tt class="py-op">)</tt><tt class="py-op">,</tt> <tt class="py-name">input_mask</tt><tt class="py-op">,</tt> <tt class="py-name">output_mask</tt><tt class="py-op">)</tt> </tt>
<a name="L849"></a><tt class="py-lineno">849</tt>  <tt class="py-line"> </tt>
<a name="L850"></a><tt class="py-lineno">850</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">pca</tt> <tt class="py-keyword">is</tt> <tt class="py-name">None</tt><tt class="py-op">:</tt> </tt>
<a name="L851"></a><tt class="py-lineno">851</tt>  <tt class="py-line">                <tt class="py-name">inputs</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">)</tt> </tt>
<a name="L852"></a><tt class="py-lineno">852</tt>  <tt class="py-line"> </tt>
<a name="L853"></a><tt class="py-lineno">853</tt>  <tt class="py-line">                <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L854"></a><tt class="py-lineno">854</tt>  <tt class="py-line">                        <tt class="py-keyword">print</tt> <tt class="py-string">'Performing PCA...'</tt> </tt>
<a name="L855"></a><tt class="py-lineno">855</tt>  <tt class="py-line"> </tt>
<a name="L856"></a><tt class="py-lineno">856</tt>  <tt class="py-line">                <tt class="py-name">pca</tt> <tt class="py-op">=</tt> <tt class="py-name">PCATransform</tt><tt class="py-op">(</tt><tt class="py-name">inputs</tt><tt class="py-op">,</tt> <tt class="py-name">var_explained</tt><tt class="py-op">=</tt><tt class="py-name">var_explained</tt><tt class="py-op">)</tt> </tt>
<a name="L857"></a><tt class="py-lineno">857</tt>  <tt class="py-line"> </tt>
<a name="L858"></a><tt class="py-lineno">858</tt>  <tt class="py-line">        <tt class="py-keyword">if</tt> <tt class="py-name">verbosity</tt> <tt class="py-op">&gt;</tt> <tt class="py-number">0</tt><tt class="py-op">:</tt> </tt>
<a name="L859"></a><tt class="py-lineno">859</tt>  <tt class="py-line">                <tt class="py-keyword">print</tt> <tt class="py-string">'Reducing dimensionality of data...'</tt> </tt>
<a name="L860"></a><tt class="py-lineno">860</tt>  <tt class="py-line"> </tt>
<a name="L861"></a><tt class="py-lineno">861</tt>  <tt class="py-line">        <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">:</tt> </tt>
<a name="L862"></a><tt class="py-lineno">862</tt>  <tt class="py-line">                <tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-op">=</tt> <tt class="py-name">pca</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt><tt class="py-op">)</tt> </tt>
<a name="L863"></a><tt class="py-lineno">863</tt>  <tt class="py-line"> </tt>
<a name="L864"></a><tt class="py-lineno">864</tt>  <tt class="py-line">        <tt class="py-name">inputs</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'inputs'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">)</tt> </tt>
<a name="L865"></a><tt class="py-lineno">865</tt>  <tt class="py-line">        <tt class="py-name">outputs</tt> <tt class="py-op">=</tt> <tt class="py-name">hstack</tt><tt class="py-op">(</tt><tt class="py-name">entry</tt><tt class="py-op">[</tt><tt class="py-string">'outputs'</tt><tt class="py-op">]</tt> <tt class="py-keyword">for</tt> <tt class="py-name">entry</tt> <tt class="py-keyword">in</tt> <tt class="py-name">data</tt><tt class="py-op">)</tt> </tt>
<a name="L866"></a><tt class="py-lineno">866</tt>  <tt class="py-line"> </tt>
<a name="L867"></a><tt class="py-lineno">867</tt>  <tt class="py-line">        <tt class="py-keyword">return</tt> <tt class="py-name">inputs</tt><tt class="py-op">,</tt> <tt class="py-name">outputs</tt><tt class="py-op">,</tt> <tt class="py-op">{</tt> </tt>
<a name="L868"></a><tt class="py-lineno">868</tt>  <tt class="py-line">                <tt class="py-string">'input_mask'</tt><tt class="py-op">:</tt> <tt class="py-name">input_mask</tt><tt class="py-op">,</tt> </tt>
<a name="L869"></a><tt class="py-lineno">869</tt>  <tt class="py-line">                <tt class="py-string">'output_mask'</tt><tt class="py-op">:</tt> <tt class="py-name">output_mask</tt><tt class="py-op">,</tt> </tt>
<a name="L870"></a><tt class="py-lineno">870</tt>  <tt class="py-line">                <tt class="py-string">'pca'</tt><tt class="py-op">:</tt> <tt class="py-name">pca</tt><tt class="py-op">}</tt> </tt>
</div><a name="L871"></a><tt class="py-lineno">871</tt>  <tt class="py-line"> </tt>
<a name="L872"></a><tt class="py-lineno">872</tt>  <tt class="py-line"> </tt>
<a name="L873"></a><tt class="py-lineno">873</tt>  <tt class="py-line"> </tt>
<a name="L874"></a><tt class="py-lineno">874</tt>  <tt class="py-line"><tt class="py-comment"># base64 encoded pickled default model</tt> </tt>
<a name="L875"></a><tt class="py-lineno">875</tt>  <tt class="py-line"><tt class="py-name">DEFAULT_MODEL</tt> <tt class="py-op">=</tt> <tt class="py-string">"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"</tt> </tt>
<a name="L876"></a><tt class="py-lineno">876</tt>  <tt class="py-line"> </tt><script type="text/javascript">
<!--
expandto(location.href);
// -->
</script>
</pre>
<br />
<!-- ==================== NAVIGATION BAR ==================== -->
<table class="navbar" border="0" width="100%" cellpadding="0"
       bgcolor="#a0c0ff" cellspacing="0">
  <tr valign="middle">
  <!-- Home link -->
      <th bgcolor="#70b0f0" class="navbar-select"
          >&nbsp;&nbsp;&nbsp;Home&nbsp;&nbsp;&nbsp;</th>

  <!-- Tree link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="module-tree.html">Trees</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Index link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="identifier-index.html">Indices</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Help link -->
      <th>&nbsp;&nbsp;&nbsp;<a
        href="help.html">Help</a>&nbsp;&nbsp;&nbsp;</th>

  <!-- Project homepage -->
      <th class="navbar" align="right" width="100%">
        <table border="0" cellpadding="0" cellspacing="0">
          <tr><th class="navbar" align="center"
            ><a class="navbar" target="_top" href="https://github.com/lucastheis/c2s">c2s</a></th>
          </tr></table></th>
  </tr>
</table>
<table border="0" cellpadding="0" cellspacing="0" width="100%%">
  <tr>
    <td align="left" class="footer">
    Generated by Epydoc 3.0.1 on Mon Nov  3 14:09:03 2014
    </td>
    <td align="right" class="footer">
      <a target="mainFrame" href="http://epydoc.sourceforge.net"
        >http://epydoc.sourceforge.net</a>
    </td>
  </tr>
</table>

<script type="text/javascript">
  <!--
  // Private objects are initially displayed (because if
  // javascript is turned off then we want them to be
  // visible); but by default, we want to hide them.  So hide
  // them unless we have a cookie that says to show them.
  checkCookie();
  // -->
</script>
</body>
</html>
